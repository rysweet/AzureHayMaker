{
  "bundle_id": "b23a48c2-3c35-45a4-852a-63e64888d4ba",
  "name": "testing-scenario:-role-based-access-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "analysis",
      "reporting",
      "test-execution",
      "test-coding",
      "automation",
      "framework-setup",
      "test-design",
      "planning"
    ],
    "skill_names": [
      "documenter",
      "tester"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: Role-Based Access Control (RBAC) Assignments\n\n## Objective\n# Scenario: Role-Based Access Control (RBAC) Assignments\n\n## Technology Area\nIdentity\n\n## Company Profile\n- **Company Size**: Mid-size\n- **Industry**: Enterprise Software\n- **Use Case**: Managing team permissions across Azure resources with principle of least privilege and role hierarchy\n\n## Scenario Description\nImplement and manage role-based access control (RBAC) assignments across Azure resources. This scenario covers creating role assignments for users, groups, and service principals at different scopes (subscription, resource group, resource). It demonstrates hierarchy, inheritance, and proper permission delegation.\n\n## Azure Services Used\n- Azure Entra ID (formerly Azure AD)\n- Azure Role-Based Access Control (RBAC)\n- Azure Resource Manager\n- Azure Subscription\n- Azure Resource Groups\n\n## Prerequisites\n- Azure subscription with Owner role at subscription level\n- Azure CLI installed and configured\n- Access to create Entra ID groups\n- Users or service principals to assign roles to\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-rbac-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nSUBSCRIPTION_ID=$(az account show --query id -o tsv)\nGROUP_PREFIX=\"azurehaymaker-group-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=identity-rbac-assignments Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Entra ID groups for role management\nADMIN_GROUP=$(az ad group create \\\n  --display-name \"${GROUP_PREFIX}-admins\" \\\n  --mail-nickname \"azurehaymaker-admins-${UNIQUE_ID}\" \\\n  --output json)\n\nADMIN_GROUP_ID=$(echo $ADMIN_GROUP | jq -r '.id')\n\n# Step 3: Create developer group\nDEV_GROUP=$(az ad group create \\\n  --display-name \"${GROUP_PREFIX}-developers\" \\\n  --mail-nickname \"azurehaymaker-devs-${UNIQUE_ID}\" \\\n  --output json)\n\nDEV_GROUP_ID=$(echo $DEV_GROUP | jq -r '.id')\n\n# Step 4: Create read-only group\nREADER_GROUP=$(az ad group create \\\n  --display-name \"${GROUP_PREFIX}-readers\" \\\n  --mail-nickname \"azurehaymaker-readers-${UNIQUE_ID}\" \\\n  --output json)\n\nREADER_GROUP_ID=$(echo $READER_GROUP | jq -r '.id')\n\n# Step 5: Create service principal for app access\nSP=$(az ad sp create-for-rbac \\\n  --name \"azurehaymaker-rbac-sp-${UNIQUE_ID}\" \\\n  --skip-assignment \\\n  --output json)\n\nSP_APP_ID=$(echo $SP | jq -r '.appId')\nSP_OBJECT_ID=$(az ad sp show --id \"${SP_APP_ID}\" --query id -o tsv)\n\n# Step 6: Assign Owner role at resource group level to admin group\naz role assignment create \\\n  --assignee-object-id \"${ADMIN_GROUP_ID}\" \\\n  --role \"Owner\" \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP}\"\n\n# Step 7: Assign Contributor role at resource group level to developer group\naz role assignment create \\\n  --assignee-object-id \"${DEV_GROUP_ID}\" \\\n  --role \"Contributor\" \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP}\"\n\n# Step 8: Assign Reader role at resource group level to reader group\naz role assignment create \\\n  --assignee-object-id \"${READER_GROUP_ID}\" \\\n  --role \"Reader\" \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP}\"\n\n# Step 9: Assign Storage Blob Data Contributor role to service principal (specific permission)\naz role assignment create \\\n  --assignee-object-id \"${SP_OBJECT_ID}\" \\\n  --role \"Storage Blob Data Contributor\" \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP}\"\n\necho \"Admin Group ID: ${ADMIN_GROUP_ID}\"\necho \"Developer Group ID: ${DEV_GROUP_ID}\"\necho \"Reader Group ID: ${READER_GROUP_ID}\"\necho \"Service Principal App ID: ${SP_APP_ID}\"\n```\n\n### Validation\n```bash\n# Verify resource group\naz group show --name \"${RESOURCE_GROUP}\" --output table\n\n# List all Entra ID groups created\naz ad group list --filter \"startswith(displayName, '${GROUP_PREFIX}')\" --output table\n\n# Check role assignments for admin group\naz role assignment list \\\n  --assignee-object-id \"${ADMIN_GROUP_ID}\" \\\n  --output table\n\n# Check role assignments for developer group\naz role assignment list \\\n  --assignee-object-id \"${DEV_GROUP_ID}\" \\\n  --output table\n\n# Check role assignments for reader group\naz role assignment list \\\n  --assignee-object-id \"${READER_GROUP_ID}\" \\\n  --output table\n\n# Check role assignments for service principal\naz role assignment list \\\n  --assignee-object-id \"${SP_OBJECT_ID}\" \\\n  --output table\n\n# List all role assignments in resource group\naz role assignment list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --all \\\n  --output table\n\n# Get group membership information\naz ad group member list \\\n  --group \"${ADMIN_GROUP_ID}\" \\\n  --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Check available roles\naz role definition list --output table | head -20\n\n# Operation 2: Get detailed information about a specific role\naz role definition show \\\n  --name \"Contributor\" \\\n  --output table\n\n# Operation 3: List role assignments at subscription level\naz role assignment list \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}\" \\\n  --output table | head -20\n\n# Operation 4: Add user to developer group (simulate with object ID)\nCURRENT_USER_ID=$(az account show --query user.objectId -o tsv)\naz ad group member add \\\n  --group \"${DEV_GROUP_ID}\" \\\n  --member-id \"${CURRENT_USER_ID}\" \\\n  2>/dev/null || echo \"User already in group or operation not permitted\"\n\n# Operation 5: Check who has access to a specific resource group\naz role assignment list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"[*].[principalName, roleDefinitionName, scope]\" \\\n  --output table\n\n# Operation 6: Remove a user from a group\naz ad group member remove \\\n  --group \"${READER_GROUP_ID}\" \\\n  --member-id \"${CURRENT_USER_ID}\" \\\n  2>/dev/null || echo \"User not in group or operation not permitted\"\n\n# Operation 7: Create custom role definition based on built-in role\naz role definition list --name \"Reader\" --output json > /tmp/custom-role.json\n\n# Operation 8: List all role assignments assigned by a specific principal\naz role assignment list \\\n  --assignee \"${CURRENT_USER_ID}\" \\\n  --output table\n\n# Operation 9: Evaluate permission for current user on resource group\naz role assignment list \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP}\" \\\n  --query \"[?principalId=='${CURRENT_USER_ID}']\" \\\n  --output table\n\n# Operation 10: Create a deny assignment (prevent specific action)\n# Note: This typically requires Owner role at subscription level\naz role assignment create \\\n  --assignee-object-id \"${READER_GROUP_ID}\" \\\n  --role \"Virtual Machine Contributor\" \\\n  --scope \"/subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${RESOURCE_GROUP}\" \\\n  2>/dev/null || echo \"Assignment created or already exists\"\n\n# Operation 11: Check if principal has specific permission\naz role definition show --name \"Owner\" --query \"permissions[*].actions\" --output table\n\n# Operation 12: List all group membership of current user\naz ad group member list \\\n  --group \"${DEV_GROUP_ID}\" \\\n  --output table\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Remove all role assignments from resource group\naz role assignment delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  2>/dev/null || true\n\n# Step 2: Remove role assignments at subscription level for created groups\naz role assignment list \\\n  --all \\\n  --query \"[?assigneeObjectId=='${ADMIN_GROUP_ID}' || assigneeObjectId=='${DEV_GROUP_ID}' || assigneeObjectId=='${READER_GROUP_ID}' || assigneeObjectId=='${SP_OBJECT_ID}']\" \\\n  --output json | jq -r '.[].id' | xargs -I {} az role assignment delete --ids {} 2>/dev/null || true\n\n# Step 3: Delete service principal\naz ad sp delete --id \"${SP_APP_ID}\" 2>/dev/null || true\n\n# Step 4: Delete Entra ID groups\naz ad group delete --group \"${ADMIN_GROUP_ID}\" 2>/dev/null || true\naz ad group delete --group \"${DEV_GROUP_ID}\" 2>/dev/null || true\naz ad group delete --group \"${READER_GROUP_ID}\" 2>/dev/null || true\n\n# Step 5: Delete resource group\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 6: Wait for deletion\necho \"Waiting for cleanup to complete...\"\nsleep 60\n\n# Step 7: Verify resource group deletion\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 8: Confirm groups are deleted\naz ad group list --filter \"startswith(displayName, '${GROUP_PREFIX}')\" --output table\n\necho \"RBAC assignments and groups successfully cleaned up\"\n```\n\n---\n\n## Resource Naming Convention\n- Admin Group: `azurehaymaker-group-${UNIQUE_ID}-admins`\n- Developer Group: `azurehaymaker-group-${UNIQUE_ID}-developers`\n- Reader Group: `azurehaymaker-group-${UNIQUE_ID}-readers`\n- Service Principal: `azurehaymaker-rbac-sp-${UNIQUE_ID}`\n- Resource Group: `azurehaymaker-rbac-${UNIQUE_ID}-rg`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Azure RBAC Overview](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview)\n- [Assign Azure Roles using Azure CLI](https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-cli)\n- [Built-in Azure Roles](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)\n- [Azure Entra ID Groups](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-manage-groups)\n- [Custom Azure Roles](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI\n\n**Rationale**: Azure CLI provides comprehensive RBAC management capabilities with commands for creating role assignments, managing group membership, and querying permissions. The CLI is ideal for implementing principle of least privilege and automating access control workflows.\n\n---\n\n## Estimated Duration\n- **Deployment**: 10-15 minutes\n- **Operations Phase**: 8+ hours (permission audits, membership management, access reviews)\n- **Cleanup**: 5-10 minutes\n\n---\n\n## Notes\n- RBAC uses role-based permissions with Owner, Contributor, and Reader roles\n- Groups allow for easier management of permissions across multiple users\n- Roles can be assigned at subscription, resource group, or resource level\n- Principle of least privilege should guide all role assignments\n- Service principals can have specific roles assigned for application access\n- Role inheritance flows from parent scope to child resources\n- Azure RBAC supports deny assignments to explicitly block access\n- Group membership changes take time to propagate through Azure AD\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Role-Based Access Control (RBAC) Assignm...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Role-Based Access Control (RBAC) Assignm...' is achieved"
    ],
    "constraints": []
  }
}
