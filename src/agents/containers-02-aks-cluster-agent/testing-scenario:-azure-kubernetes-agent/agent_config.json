{
  "bundle_id": "899aa8e8-a633-4c9c-bf2e-b48ae2817c3b",
  "name": "testing-scenario:-azure-kubernetes-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "test-execution",
      "automation",
      "analysis",
      "test-coding",
      "framework-setup",
      "planning",
      "reporting",
      "test-design"
    ],
    "skill_names": [
      "documenter",
      "tester"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: Azure Kubernetes Service (AKS) Cluster\n\n## Objective\n# Scenario: Azure Kubernetes Service (AKS) Cluster\n\n## Technology Area\nContainers\n\n## Company Profile\n- **Company Size**: Large enterprise\n- **Industry**: Technology / Cloud Services\n- **Use Case**: Run microservices-based applications on managed Kubernetes\n\n## Scenario Description\nDeploy a managed Kubernetes cluster using Azure Kubernetes Service (AKS). Set up node pools, deploy sample applications, configure ingress controller, and implement autoscaling policies for production-ready container orchestration.\n\n## Azure Services Used\n- Azure Kubernetes Service (AKS)\n- Azure Container Registry (image storage)\n- Azure Virtual Network (networking)\n- Azure Monitor (logging and monitoring)\n- Azure Key Vault (secrets management)\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed with kubectl extension\n- Docker installed (for building images)\n- A unique identifier for this scenario run\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-containers-aks-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nAKS_CLUSTER=\"azurehaymaker-aks-${UNIQUE_ID}\"\nACR_REGISTRY=\"azmkraks${UNIQUE_ID}\"\nVNET_NAME=\"azurehaymaker-vnet-${UNIQUE_ID}\"\nKEYVAULT=\"azurehaymaker-kv-${UNIQUE_ID}\"\nLOG_ANALYTICS=\"azurehaymaker-logs-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=containers-aks Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Virtual Network\naz network vnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VNET_NAME}\" \\\n  --address-prefix \"10.0.0.0/16\" \\\n  --subnet-name \"aks-subnet\" \\\n  --subnet-prefixes \"10.0.0.0/22\" \\\n  --tags ${TAGS}\n\nSUBNET_ID=$(az network vnet subnet show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"aks-subnet\" \\\n  --query id -o tsv)\n\n# Step 3: Create Azure Container Registry\naz acr create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${ACR_REGISTRY}\" \\\n  --sku Standard \\\n  --admin-enabled true \\\n  --tags ${TAGS}\n\n# Step 4: Create Key Vault\naz keyvault create \\\n  --name \"${KEYVAULT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 5: Create Log Analytics Workspace\naz monitor log-analytics workspace create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --workspace-name \"${LOG_ANALYTICS}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\nLOG_ANALYTICS_ID=$(az monitor log-analytics workspace show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --workspace-name \"${LOG_ANALYTICS}\" \\\n  --query customerId -o tsv)\n\nLOG_ANALYTICS_KEY=$(az monitor log-analytics workspace get-shared-keys \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --workspace-name \"${LOG_ANALYTICS}\" \\\n  --query primarySharedKey -o tsv)\n\n# Step 6: Create AKS Cluster\naz aks create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${AKS_CLUSTER}\" \\\n  --location \"${LOCATION}\" \\\n  --node-count 2 \\\n  --vm-set-type VirtualMachineScaleSets \\\n  --load-balancer-sku standard \\\n  --enable-managed-identity \\\n  --network-plugin azure \\\n  --vnet-subnet-id \"${SUBNET_ID}\" \\\n  --docker-bridge-address \"172.17.0.1/16\" \\\n  --service-cidr \"10.0.0.0/16\" \\\n  --dns-service-ip \"10.0.0.10\" \\\n  --enable-addons monitoring \\\n  --workspace-resource-id \"/subscriptions/$(az account show --query id -o tsv)/resourcegroups/${RESOURCE_GROUP}/providers/microsoft.operationalinsights/workspaces/${LOG_ANALYTICS}\" \\\n  --enable-cluster-autoscaling \\\n  --min-count 1 \\\n  --max-count 5 \\\n  --attach-acr \"${ACR_REGISTRY}\" \\\n  --tags ${TAGS}\n\n# Step 7: Get credentials\naz aks get-credentials \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${AKS_CLUSTER}\" \\\n  --overwrite-existing\n\n# Step 8: Build and push sample container image\ncat > /tmp/Dockerfile <<EOF\nFROM nginx:alpine\nRUN echo '<html><body><h1>AKS Sample App</h1><p>Scenario: containers-aks</p></body></html>' > /usr/share/nginx/html/index.html\nEOF\n\nACR_LOGIN_SERVER=$(az acr show \\\n  --name \"${ACR_REGISTRY}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query loginServer -o tsv)\n\naz acr build \\\n  --registry \"${ACR_REGISTRY}\" \\\n  --image \"aks-sample:v1\" \\\n  --file /tmp/Dockerfile \\\n  /tmp/\n\n# Step 9: Create sample Kubernetes deployment manifest\ncat > /tmp/deployment.yaml <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: aks-sample-app\n  labels:\n    app: aks-sample\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: aks-sample\n  template:\n    metadata:\n      labels:\n        app: aks-sample\n    spec:\n      containers:\n      - name: app\n        image: ${ACR_LOGIN_SERVER}/aks-sample:v1\n        ports:\n        - containerPort: 80\n        resources:\n          requests:\n            cpu: 100m\n            memory: 128Mi\n          limits:\n            cpu: 250m\n            memory: 256Mi\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: aks-sample-service\nspec:\n  type: LoadBalancer\n  selector:\n    app: aks-sample\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 80\nEOF\n\n# Step 10: Deploy application to AKS\nkubectl apply -f /tmp/deployment.yaml\n\necho \"\"\necho \"==========================================\"\necho \"AKS Cluster Created: ${AKS_CLUSTER}\"\necho \"ACR Registry: ${ACR_LOGIN_SERVER}\"\necho \"==========================================\"\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Verify AKS Cluster\naz aks show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${AKS_CLUSTER}\"\n\n# Check cluster status\naz aks show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${AKS_CLUSTER}\" \\\n  --query \"powerState.code\" -o tsv\n\n# Verify ACR\naz acr show \\\n  --name \"${ACR_REGISTRY}\" \\\n  --resource-group \"${RESOURCE_GROUP}\"\n\n# List ACR repositories\naz acr repository list \\\n  --name \"${ACR_REGISTRY}\" \\\n  --output table\n\n# Get kubectl nodes\nkubectl get nodes -o wide\n\n# Get deployments\nkubectl get deployments -o wide\n\n# Get services\nkubectl get svc -o wide\n\n# Get pods\nkubectl get pods -o wide\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Scale deployment\nkubectl scale deployment aks-sample-app --replicas=4\n\n# Operation 2: Check pod status\nkubectl get pods -o wide\n\n# Operation 3: View pod logs\nkubectl logs -l app=aks-sample --tail=20\n\n# Operation 4: Deploy updated image\naz acr build \\\n  --registry \"${ACR_REGISTRY}\" \\\n  --image \"aks-sample:v2\" \\\n  --file /tmp/Dockerfile \\\n  /tmp/\n\n# Operation 5: Update deployment with new image\nkubectl set image deployment/aks-sample-app app=${ACR_LOGIN_SERVER}/aks-sample:v2\n\n# Operation 6: Check deployment status\nkubectl rollout status deployment/aks-sample-app\n\n# Operation 7: Scale cluster nodes\naz aks scale \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${AKS_CLUSTER}\" \\\n  --node-count 3\n\n# Operation 8: Monitor cluster metrics\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.ContainerService/managedClusters/${AKS_CLUSTER}\" \\\n  --metric \"node_cpu_usage_percentage\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 9: Add node pool\naz aks nodepool add \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --cluster-name \"${AKS_CLUSTER}\" \\\n  --name \"nodepool2\" \\\n  --node-count 1\n\n# Operation 10: View cluster events\nkubectl get events --all-namespaces --sort-by='.lastTimestamp'\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete Kubernetes deployments\nkubectl delete deployment aks-sample-app\n\n# Step 2: Delete Kubernetes services\nkubectl delete svc aks-sample-service\n\n# Step 3: Delete AKS cluster\naz aks delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${AKS_CLUSTER}\" \\\n  --yes \\\n  --no-wait\n\n# Step 4: Delete the entire resource group\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 5: Verify deletion\nsleep 120\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 6: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n\n# Step 7: Clean up kubeconfig\nkubectl config delete-context \"${AKS_CLUSTER}\"\nkubectl config delete-cluster \"${AKS_CLUSTER}\"\n\n# Step 8: Clean up local files\nrm -rf /tmp/Dockerfile /tmp/deployment.yaml\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-containers-aks-${UNIQUE_ID}-rg`\n- AKS Cluster: `azurehaymaker-aks-${UNIQUE_ID}`\n- ACR Registry: `azmkraks${UNIQUE_ID}`\n- Virtual Network: `azurehaymaker-vnet-${UNIQUE_ID}`\n- Key Vault: `azurehaymaker-kv-${UNIQUE_ID}`\n- Log Analytics: `azurehaymaker-logs-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Azure Kubernetes Service Overview](https://learn.microsoft.com/en-us/azure/aks/intro-kubernetes)\n- [Create AKS Cluster](https://learn.microsoft.com/en-us/azure/aks/kubernetes-walkthrough)\n- [AKS Cluster Autoscaling](https://learn.microsoft.com/en-us/azure/aks/cluster-autoscaler)\n- [AKS Networking](https://learn.microsoft.com/en-us/azure/aks/concepts-network)\n- [AKS CLI Reference](https://learn.microsoft.com/en-us/cli/azure/aks)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI (for provisioning) + kubectl (for Kubernetes management)\n\n**Rationale**: Azure CLI handles AKS cluster provisioning while kubectl manages application deployments. This combination is optimal for container orchestration on Azure.\n\n---\n\n## Estimated Duration\n- **Deployment**: 20-25 minutes (AKS cluster provisioning takes time)\n- **Operations Phase**: 8 hours (with scaling, deployments, and monitoring)\n- **Cleanup**: 10-15 minutes\n\n---\n\n## Notes\n- AKS provides managed Kubernetes with automatic updates and patching\n- Cluster autoscaling automatically adjusts node count based on resource demands\n- Multiple node pools support workload isolation\n- Network integration provides secure pod networking\n- All operations scoped to single tenant and subscription\n- RBAC and managed identity provide security\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Azure Kubernetes Service (AKS) Cluster...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Azure Kubernetes Service (AKS) Cluster...' is achieved"
    ],
    "constraints": []
  }
}
