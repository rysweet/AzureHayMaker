{
  "bundle_id": "9f72bc27-61de-4039-ad64-0155aa38b35d",
  "name": "testing-scenario:-node.js-application-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "simple",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "22 minutes",
    "required_capabilities": [
      "automation",
      "test-design",
      "test-coding",
      "analysis",
      "test-execution",
      "reporting",
      "framework-setup",
      "planning"
    ],
    "skill_names": [
      "documenter",
      "tester"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "Standard execution risks apply"
    ]
  },
  "auto_mode_config": {
    "max_turns": 6,
    "initial_prompt": "# Goal: Scenario: Node.js Application on Azure App Service\n\n## Objective\n# Scenario: Node.js Application on Azure App Service\n\n## Technology Area\nWeb Apps\n\n## Company Profile\n- **Company Size**: Mid-size technology startup\n- **Industry**: SaaS / Web Services\n- **Use Case**: Host Node.js REST API backend with automatic scaling\n\n## Scenario Description\nDeploy a Node.js application to Azure App Service with continuous deployment from Git, environment configuration management, and automatic scaling based on HTTP metrics.\n\n## Azure Services Used\n- Azure App Service (hosting)\n- Azure App Service Plan (compute resources)\n- Azure SQL Database (data storage)\n- Azure Application Insights (monitoring)\n- Azure Key Vault (secrets)\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed\n- Node.js installed (for local testing)\n- A unique identifier for this scenario run\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-webapp-nodejs-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nAPP_SERVICE_PLAN=\"azurehaymaker-plan-${UNIQUE_ID}\"\nAPP_SERVICE=\"azurehaymaker-nodejs-${UNIQUE_ID}\"\nINSIGHTS_NAME=\"azurehaymaker-insights-${UNIQUE_ID}\"\nKEYVAULT=\"azurehaymaker-kv-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=webapps-nodejs Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Key Vault\naz keyvault create \\\n  --name \"${KEYVAULT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 3: Create Application Insights\naz monitor app-insights component create \\\n  --app \"${INSIGHTS_NAME}\" \\\n  --location \"${LOCATION}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --application-type web \\\n  --tags ${TAGS}\n\nINSIGHTS_KEY=$(az monitor app-insights component show \\\n  --app \"${INSIGHTS_NAME}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"instrumentationKey\" -o tsv)\n\n# Store in Key Vault\naz keyvault secret set \\\n  --vault-name \"${KEYVAULT}\" \\\n  --name \"app-insights-key\" \\\n  --value \"${INSIGHTS_KEY}\"\n\n# Step 4: Create App Service Plan\naz appservice plan create \\\n  --name \"${APP_SERVICE_PLAN}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --sku B2 \\\n  --is-linux \\\n  --tags ${TAGS}\n\n# Step 5: Create sample Node.js application\nmkdir -p /tmp/nodejs-app\ncat > /tmp/nodejs-app/package.json <<EOF\n{\n  \"name\": \"azure-nodejs-app\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Sample Node.js App for Azure App Service\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"node index.js\",\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"dependencies\": {\n    \"express\": \"^4.18.2\"\n  },\n  \"engines\": {\n    \"node\": \">=18.0.0\"\n  }\n}\nEOF\n\ncat > /tmp/nodejs-app/index.js <<EOF\nconst express = require('express');\nconst app = express();\nconst port = process.env.PORT || 8080;\n\napp.get('/', (req, res) => {\n  res.json({\n    message: 'Azure HayMaker Node.js App',\n    scenario: 'webapps-nodejs-app-service',\n    timestamp: new Date().toISOString(),\n    environment: process.env.NODE_ENV || 'development'\n  });\n});\n\napp.get('/health', (req, res) => {\n  res.json({ status: 'healthy' });\n});\n\napp.get('/api/info', (req, res) => {\n  res.json({\n    app: 'Azure HayMaker',\n    version: '1.0.0',\n    uptime: process.uptime()\n  });\n});\n\napp.listen(port, () => {\n  console.log(\\`App listening on port \\${port}\\`);\n});\nEOF\n\n# Step 6: Create Azure App Service\naz webapp create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --plan \"${APP_SERVICE_PLAN}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --runtime \"NODE|18.0\" \\\n  --tags ${TAGS}\n\n# Step 7: Configure app settings\naz webapp config appsettings set \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --settings \\\n    NODE_ENV=production \\\n    WEBSITE_NODE_DEFAULT_VERSION=18.0 \\\n    APPINSIGHTS_INSTRUMENTATIONKEY=\"${INSIGHTS_KEY}\"\n\n# Step 8: Configure connection strings (if needed)\naz webapp config connection-string set \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --settings \\\n    DefaultConnection=\"Server=tcp:example.database.windows.net,1433\" \\\n  --connection-string-type SQLAzure\n\n# Step 9: Deploy application code\ncd /tmp/nodejs-app\nnpm install\nzip -r /tmp/app.zip .\n\naz webapp deployment source config-zip \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --src /tmp/app.zip\n\n# Step 10: Enable automatic scaling\naz monitor autoscale create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"nodejs-autoscale\" \\\n  --resource-namespace \"Microsoft.Web\" \\\n  --resource-type \"serverFarms\" \\\n  --resource \"${APP_SERVICE_PLAN}\" \\\n  --min-count 1 \\\n  --max-count 5 \\\n  --count 2\n\n# Add scale rule\naz monitor autoscale rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --autoscale-name \"nodejs-autoscale\" \\\n  --condition \"Percentage CPU > 75 avg 5m 2 times count 3\" \\\n  --scale out 1\n\naz monitor autoscale rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --autoscale-name \"nodejs-autoscale\" \\\n  --condition \"Percentage CPU < 25 avg 5m 1 times count 1\" \\\n  --scale in 1\n\necho \"\"\necho \"==========================================\"\necho \"Node.js App Service Created: ${APP_SERVICE}\"\necho \"URL: https://${APP_SERVICE}.azurewebsites.net\"\necho \"==========================================\"\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Verify App Service\naz webapp show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\"\n\n# Get App Service status\naz webapp show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --query \"state\" -o tsv\n\n# Get App Service URL\nAPP_URL=$(az webapp show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --query \"defaultHostName\" -o tsv)\n\necho \"App URL: https://${APP_URL}\"\n\n# Test application endpoint\ncurl -s \"https://${APP_URL}/\"\n\n# Check Application Insights\naz monitor app-insights component show \\\n  --app \"${INSIGHTS_NAME}\" \\\n  --resource-group \"${RESOURCE_GROUP}\"\n\n# List app settings\naz webapp config appsettings list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\"\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: View application logs\naz webapp log tail \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --provider \"anyazure\" \\\n  --tail 20\n\n# Operation 2: Restart web app\naz webapp restart \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\"\n\n# Operation 3: Deploy updated code\ncat > /tmp/nodejs-app/index.js <<EOF\nconst express = require('express');\nconst app = express();\nconst port = process.env.PORT || 8080;\n\napp.get('/', (req, res) => {\n  res.json({\n    message: 'Azure HayMaker Node.js App - UPDATED',\n    scenario: 'webapps-nodejs-app-service',\n    timestamp: new Date().toISOString(),\n    version: '2.0.0'\n  });\n});\n\napp.get('/health', (req, res) => {\n  res.json({ status: 'healthy' });\n});\n\napp.listen(port, () => {\n  console.log(\\`App listening on port \\${port}\\`);\n});\nEOF\n\ncd /tmp/nodejs-app\nnpm install\nzip -r /tmp/app-updated.zip .\n\naz webapp deployment source config-zip \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\" \\\n  --src /tmp/app-updated.zip\n\n# Operation 4: Scale up manually\naz appservice plan update \\\n  --name \"${APP_SERVICE_PLAN}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --sku B3\n\n# Operation 5: Monitor application performance\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Web/sites/${APP_SERVICE}\" \\\n  --metric \"CPU%\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 6: Configure SSL/TLS\necho \"To add SSL certificate:\"\necho \"az webapp config ssl bind --certificate-thumbprint <thumbprint> --resource-group ${RESOURCE_GROUP} --name ${APP_SERVICE}\"\n\n# Operation 7: Add custom domain\necho \"To add custom domain:\"\necho \"az webapp config hostname add --webapp-name ${APP_SERVICE} --resource-group ${RESOURCE_GROUP} --hostname www.example.com\"\n\n# Operation 8: Enable managed identity\naz webapp identity assign \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${APP_SERVICE}\"\n\n# Operation 9: Check autoscale metrics\naz monitor autoscale show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"nodejs-autoscale\"\n\n# Operation 10: Test health endpoint\ncurl -s \"https://${APP_URL}/health\" | jq .\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete autoscale settings\naz monitor autoscale delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"nodejs-autoscale\" \\\n  --yes\n\n# Step 2: Delete the entire resource group\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 3: Verify deletion\nsleep 60\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 4: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n\n# Step 5: Clean up local files\nrm -rf /tmp/nodejs-app /tmp/app.zip /tmp/app-updated.zip\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-webapp-nodejs-${UNIQUE_ID}-rg`\n- App Service: `azurehaymaker-nodejs-${UNIQUE_ID}`\n- App Service Plan: `azurehaymaker-plan-${UNIQUE_ID}`\n- Application Insights: `azurehaymaker-insights-${UNIQUE_ID}`\n- Key Vault: `azurehaymaker-kv-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [App Service Overview](https://learn.microsoft.com/en-us/azure/app-service/overview)\n- [Node.js on App Service](https://learn.microsoft.com/en-us/azure/app-service/quickstart-nodejs)\n- [Autoscaling in App Service](https://learn.microsoft.com/en-us/azure/app-service/manage-scale-up)\n- [Application Insights](https://learn.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview)\n- [App Service CLI Reference](https://learn.microsoft.com/en-us/cli/azure/webapp)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI\n\n**Rationale**: Azure CLI handles App Service provisioning and management efficiently. Application code deployment uses zip deployment for simplicity.\n\n---\n\n## Estimated Duration\n- **Deployment**: 15-20 minutes\n- **Operations Phase**: 8 hours (with updates and monitoring)\n- **Cleanup**: 5-10 minutes\n\n---\n\n## Notes\n- App Service provides automatic HTTPS\n- Built-in Application Insights monitoring\n- Auto-scaling based on CPU and HTTP metrics\n- Multiple deployment options (zip, git, Docker)\n- All operations scoped to single tenant and subscription\n- Managed identity enables secure Azure resource access\n- Suitable for production Node.js applications\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Node.js Application on Azure App Service...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Node.js Application on Azure App Service...' is achieved"
    ],
    "constraints": []
  }
}
