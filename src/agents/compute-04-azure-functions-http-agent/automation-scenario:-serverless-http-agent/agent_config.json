{
  "bundle_id": "b23f0d11-0303-44a8-9031-d2d4757f084c",
  "name": "automation-scenario:-serverless-http-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "automation",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 1,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "configuration",
      "task-execution",
      "quality-check",
      "monitoring",
      "workflow-design",
      "orchestration",
      "initialization",
      "validation"
    ],
    "skill_names": [
      "monitor"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time",
      "Automated changes may have unintended side effects"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: Serverless HTTP Triggers with Azure Functions\n\n## Objective\n# Scenario: Serverless HTTP Triggers with Azure Functions\n\n## Technology Area\nCompute\n\n## Company Profile\n- **Company Size**: Small startup\n- **Industry**: Event-Driven Services / APIs\n- **Use Case**: Deploy serverless HTTP-triggered functions for lightweight API endpoints and webhooks\n\n## Scenario Description\nDeploy Azure Functions with HTTP triggers to create serverless API endpoints. Functions automatically scale based on demand, with minimal operational overhead. Includes function monitoring, logging, and integration with Application Insights.\n\n## Azure Services Used\n- Azure Functions\n- Azure Storage Account (function runtime)\n- Azure Application Insights\n- Azure Log Analytics Workspace\n- Azure Event Grid (optional for triggers)\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed with function core tools extension\n- Node.js 18+ or Python 3.9+ for local development\n- Azure Functions Core Tools installed locally (optional for testing)\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-compute-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nSTORAGE_ACCOUNT=\"azurehaymaker${UNIQUE_ID}\"\nFUNCTION_APP_NAME=\"azurehaymaker-func-${UNIQUE_ID}\"\nAPP_INSIGHTS_NAME=\"azurehaymaker-appinsights-${UNIQUE_ID}\"\nLOG_ANALYTICS_NAME=\"azurehaymaker-logs-${UNIQUE_ID}\"\nRUNTIME=\"python\"  # or \"node\" for JavaScript\nRUNTIME_VERSION=\"3.10\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=compute-azure-functions Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Log Analytics Workspace\naz monitor log-analytics workspace create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --workspace-name \"${LOG_ANALYTICS_NAME}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\nLOG_ANALYTICS_ID=$(az monitor log-analytics workspace show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --workspace-name \"${LOG_ANALYTICS_NAME}\" \\\n  --query customerId -o tsv)\n\nLOG_ANALYTICS_KEY=$(az monitor log-analytics workspace get-shared-keys \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --workspace-name \"${LOG_ANALYTICS_NAME}\" \\\n  --query primarySharedKey -o tsv)\n\n# Step 3: Create Application Insights\naz monitor app-insights component create \\\n  --app \"${APP_INSIGHTS_NAME}\" \\\n  --location \"${LOCATION}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --application-type web \\\n  --workspace \"${LOG_ANALYTICS_NAME}\" \\\n  --tags ${TAGS}\n\nINSTRUMENTATION_KEY=$(az monitor app-insights component show \\\n  --app \"${APP_INSIGHTS_NAME}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query instrumentationKey -o tsv)\n\n# Step 4: Create Storage Account for function runtime\naz storage account create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --location \"${LOCATION}\" \\\n  --sku Standard_LRS \\\n  --tags ${TAGS}\n\nSTORAGE_CONNECTION_STRING=$(az storage account show-connection-string \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --query connectionString -o tsv)\n\n# Step 5: Create Function App\naz functionapp create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --consumption-plan-location \"${LOCATION}\" \\\n  --runtime ${RUNTIME} \\\n  --runtime-version ${RUNTIME_VERSION} \\\n  --functions-version 4 \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --storage-account \"${STORAGE_ACCOUNT}\" \\\n  --os-type Linux \\\n  --tags ${TAGS}\n\n# Step 6: Configure application settings for Application Insights\naz functionapp config appsettings set \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --settings \"APPINSIGHTS_INSTRUMENTATIONKEY=${INSTRUMENTATION_KEY}\" \\\n  \"ApplicationInsightsAgent_EXTENSION_VERSION=~3\" \\\n  \"ENVIRONMENT=production\"\n\n# Step 7: Create HTTP trigger function - HelloWorld\naz functionapp function create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"HelloWorld\" \\\n  --template \"HTTP trigger\"\n\n# Step 8: Update HelloWorld function code (Python)\ncat > /tmp/hello_function_code.py <<'EOF'\nimport azure.functions as func\nimport json\nfrom datetime import datetime\n\ndef main(req: func.HttpRequest) -> func.HttpResponse:\n    \"\"\"\n    HTTP-triggered function that returns a JSON response\n    \"\"\"\n    name = req.params.get('name', 'Azure')\n\n    response_data = {\n        'message': f'Hello, {name}!',\n        'timestamp': datetime.utcnow().isoformat(),\n        'scenario': 'compute-04-azure-functions-http',\n        'function': 'HelloWorld'\n    }\n\n    return func.HttpResponse(\n        json.dumps(response_data),\n        status_code=200,\n        mimetype=\"application/json\"\n    )\nEOF\n\n# Step 9: Create API Status function\naz functionapp function create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"ApiStatus\" \\\n  --template \"HTTP trigger\"\n\n# Step 10: Create Echo function\naz functionapp function create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"Echo\" \\\n  --template \"HTTP trigger\"\n\n# Step 11: Create HealthCheck function\naz functionapp function create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"HealthCheck\" \\\n  --template \"HTTP trigger\"\n\n# Step 12: Get Function App master key for testing\nMASTER_KEY=$(az functionapp keys list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --query \"masterKey\" -o tsv)\n\n# Step 13: Get function URL\nFUNCTION_URL=$(az functionapp function show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"HelloWorld\" \\\n  --query \"invokeUrlTemplate\" -o tsv)\n\necho \"Function App Name: ${FUNCTION_APP_NAME}\"\necho \"Function URL: ${FUNCTION_URL}\"\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Verify Function App\naz functionapp show --resource-group \"${RESOURCE_GROUP}\" --name \"${FUNCTION_APP_NAME}\"\n\n# List all functions\naz functionapp function list --resource-group \"${RESOURCE_GROUP}\" --name \"${FUNCTION_APP_NAME}\" --output table\n\n# Get function app URL\nFUNC_APP_URL=$(az functionapp show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --query \"defaultHostName\" -o tsv)\n\necho \"Function App URL: https://${FUNC_APP_URL}\"\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Monitor function execution metrics\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Web/sites/${FUNCTION_APP_NAME}\" \\\n  --metric \"FunctionExecutionCount\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 2: Monitor function execution units\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Web/sites/${FUNCTION_APP_NAME}\" \\\n  --metric \"FunctionExecutionUnits\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 3: View function logs in real-time\naz webapp log tail \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --lines 50\n\n# Operation 4: Query Application Insights for recent traces\naz monitor app-insights query \\\n  --app \"${APP_INSIGHTS_NAME}\" \\\n  --analytics-query \"traces | where timestamp > ago(1h) | take 20\"\n\n# Operation 5: Get application settings\naz functionapp config appsettings list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\"\n\n# Operation 6: Update function configuration settings\naz functionapp config set \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --use-32bit-worker-process false \\\n  --always-on true\n\n# Operation 7: List function key for authentication\naz functionapp function keys list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"HelloWorld\"\n\n# Operation 8: Test HelloWorld function via HTTP\nFUNC_APP_URL=$(az functionapp show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --query \"defaultHostName\" -o tsv)\n\ncurl \"https://${FUNC_APP_URL}/api/HelloWorld?name=AzureHayMaker\"\n\n# Operation 9: Create timer-based trigger function for scheduled execution\naz functionapp function create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --function-app-name \"${FUNCTION_APP_NAME}\" \\\n  --name \"ScheduledJob\" \\\n  --template \"Timer trigger\"\n\n# Operation 10: Monitor HTTP response times\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Web/sites/${FUNCTION_APP_NAME}\" \\\n  --metric \"AverageResponseTime\" \\\n  --start-time $(date -u -d '30 minutes ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 11: Enable staging slot for blue-green deployment\naz functionapp deployment slot create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --slot \"staging\"\n\n# Operation 12: View storage account connected to function app\naz storage account list --resource-group \"${RESOURCE_GROUP}\" --output table\n\n# Operation 13: Monitor storage operations for function data\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Storage/storageAccounts/${STORAGE_ACCOUNT}\" \\\n  --metric \"Transactions\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 14: Check function app memory usage\naz functionapp config set \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FUNCTION_APP_NAME}\" \\\n  --number-of-workers 1\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete the entire resource group\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 2: Wait for deletion to complete\necho \"Waiting for resource group deletion...\"\nsleep 120\n\n# Step 3: Verify deletion\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 4: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-compute-${UNIQUE_ID}-rg`\n- Function App: `azurehaymaker-func-${UNIQUE_ID}`\n- Storage Account: `azurehaymaker${UNIQUE_ID}`\n- Application Insights: `azurehaymaker-appinsights-${UNIQUE_ID}`\n- Log Analytics: `azurehaymaker-logs-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Azure Functions Overview](https://learn.microsoft.com/en-us/azure/azure-functions/functions-overview)\n- [Create HTTP Trigger Functions](https://learn.microsoft.com/en-us/azure/azure-functions/functions-create-first-azure-function-azure-cli)\n- [Azure Functions Python Developer Guide](https://learn.microsoft.com/en-us/azure/azure-functions/functions-reference-python)\n- [Application Insights for Azure Functions](https://learn.microsoft.com/en-us/azure/azure-functions/functions-monitoring)\n- [Azure Functions Bindings](https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings)\n- [Azure Functions Pricing](https://azure.microsoft.com/en-us/pricing/details/functions/)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI\n\n**Rationale**: Azure CLI provides excellent Azure Functions management with straightforward commands for creation, deployment, and monitoring. The consumption plan model provides automatic scaling without infrastructure management.\n\n---\n\n## Estimated Duration\n- **Deployment**: 10-15 minutes\n- **Operations Phase**: 8+ hours (with function testing, monitoring, and scaling operations)\n- **Cleanup**: 5 minutes\n\n---\n\n## Notes\n- Functions run on consumption plan with automatic scaling (0-unlimited instances)\n- Charges only for actual function execution time and requests\n- HTTP triggers provide RESTful API endpoints\n- Application Insights automatically collects function performance metrics\n- Python 3.10 runtime selected for modern language features\n- Storage account required for function state and bindings\n- All operations scoped to single tenant and subscription\n- Ideal for microservices, webhooks, and event-driven architectures\n- No VM or container management required - fully serverless\n\n\n## Execution Plan\n\n### Phase 1: Setup\nConfigure automation environment\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: configuration, initialization\n\n### Phase 2: Workflow Design\nDesign automation workflow\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: workflow-design, orchestration\n**Dependencies**: Setup\n\n### Phase 3: Execution\nExecute automated tasks\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: task-execution, monitoring\n**Dependencies**: Workflow Design\n\n### Phase 4: Validation\nValidate results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: validation, quality-check\n**Dependencies**: Execution\n\n## Success Criteria\n- Goal 'Scenario: Serverless HTTP Triggers with Azure Func...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Serverless HTTP Triggers with Azure Func...' is achieved"
    ],
    "constraints": []
  }
}
