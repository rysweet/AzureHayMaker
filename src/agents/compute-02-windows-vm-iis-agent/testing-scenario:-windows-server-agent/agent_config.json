{
  "bundle_id": "44dc2aff-1a93-42f4-aef5-2e6e1dda1102",
  "name": "testing-scenario:-windows-server-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "simple",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "22 minutes",
    "required_capabilities": [
      "test-coding",
      "reporting",
      "analysis",
      "test-execution",
      "test-design",
      "planning",
      "automation",
      "framework-setup"
    ],
    "skill_names": [
      "tester",
      "documenter"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "Standard execution risks apply"
    ]
  },
  "auto_mode_config": {
    "max_turns": 6,
    "initial_prompt": "# Goal: Scenario: Windows Server VM with IIS Web Server\n\n## Objective\n# Scenario: Windows Server VM with IIS Web Server\n\n## Technology Area\nCompute\n\n## Company Profile\n- **Company Size**: Mid-size enterprise\n- **Industry**: Financial Services\n- **Use Case**: Deploy a Windows Server VM with IIS for hosting legacy ASP.NET web applications\n\n## Scenario Description\nDeploy a Windows Server 2019/2022 virtual machine with Internet Information Services (IIS) installed and configured. Includes basic web content deployment, performance monitoring, and Windows Update management.\n\n## Azure Services Used\n- Azure Virtual Machines (Windows Server)\n- Azure Network Interfaces\n- Azure Public IP Addresses\n- Azure Network Security Groups\n- Azure Managed Disks\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed and configured\n- RDP client available for remote desktop access (optional for validation)\n- Access to create virtual machines and manage Windows servers\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-compute-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nVM_NAME=\"azurehaymaker-winvm-${UNIQUE_ID}\"\nNIC_NAME=\"azurehaymaker-winnic-${UNIQUE_ID}\"\nNSG_NAME=\"azurehaymaker-winnsg-${UNIQUE_ID}\"\nVNET_NAME=\"azurehaymaker-winvnet-${UNIQUE_ID}\"\nSUBNET_NAME=\"azurehaymaker-winsubnet-${UNIQUE_ID}\"\nPUBLIC_IP_NAME=\"azurehaymaker-winpip-${UNIQUE_ID}\"\nADMIN_USERNAME=\"azureuser\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=compute-windows-iis Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Virtual Network and Subnet\naz network vnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VNET_NAME}\" \\\n  --address-prefix 10.0.0.0/16 \\\n  --subnet-name \"${SUBNET_NAME}\" \\\n  --subnet-prefix 10.0.1.0/24 \\\n  --tags ${TAGS}\n\n# Step 3: Create Network Security Group\naz network nsg create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${NSG_NAME}\" \\\n  --tags ${TAGS}\n\n# Step 4: Add security rules for RDP, HTTP, and HTTPS\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${NSG_NAME}\" \\\n  --name \"allow-rdp\" \\\n  --priority 1000 \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 3389 \\\n  --access Allow \\\n  --protocol Tcp\n\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${NSG_NAME}\" \\\n  --name \"allow-http\" \\\n  --priority 1001 \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 80 \\\n  --access Allow \\\n  --protocol Tcp\n\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${NSG_NAME}\" \\\n  --name \"allow-https\" \\\n  --priority 1002 \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 443 \\\n  --access Allow \\\n  --protocol Tcp\n\n# Step 5: Create Public IP Address\naz network public-ip create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${PUBLIC_IP_NAME}\" \\\n  --allocation-method Static \\\n  --sku Standard \\\n  --tags ${TAGS}\n\n# Step 6: Create Network Interface\naz network nic create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${NIC_NAME}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --subnet \"${SUBNET_NAME}\" \\\n  --public-ip-address \"${PUBLIC_IP_NAME}\" \\\n  --network-security-group \"${NSG_NAME}\" \\\n  --tags ${TAGS}\n\n# Step 7: Create Windows Server Virtual Machine\naz vm create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --nics \"${NIC_NAME}\" \\\n  --image Win2022Datacenter \\\n  --size Standard_B2s \\\n  --admin-username \"${ADMIN_USERNAME}\" \\\n  --admin-password \"P@ssw0rd$(openssl rand -hex 4)\" \\\n  --os-disk-name \"azurehaymaker-osdisk-${UNIQUE_ID}\" \\\n  --tags ${TAGS}\n\n# Step 8: Get the Public IP Address\nPUBLIC_IP=$(az network public-ip show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${PUBLIC_IP_NAME}\" \\\n  --query ipAddress -o tsv)\n\necho \"Public IP Address: ${PUBLIC_IP}\"\n\n# Step 9: Install IIS and required components using Custom Script Extension\naz vm extension set \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vm-name \"${VM_NAME}\" \\\n  --name CustomScriptExtension \\\n  --publisher Microsoft.Compute \\\n  --version 1.10 \\\n  --settings '{\"fileUris\":[],\"commandToExecute\":\"powershell.exe -Command \\\"Install-WindowsFeature -Name Web-Server, Web-WebServer, Web-Common-Http, Web-Default-Doc, Web-Dir-Browsing, Web-Http-Errors, Web-Static-Content, Web-Health, Web-Http-Logging, Web-Log-Libraries, Web-Request-Monitor, Web-Http-Tracing, Web-Performance, Web-Compression, Web-Security, Web-Filtering, Web-Basic-Auth, Web-Windows-Auth, Web-App-Dev, Web-Asp-Net, Web-Asp-Net45, Web-Net-Ext, Web-Net-Ext45, Web-AppInit, Web-CGI, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Includes, Web-WebSockets, Web-Mgmt-Tools, Web-Mgmt-Console, Web-Scripting-Tools, Web-Mgmt-Service -Restart\\\"\"}'\n\n# Step 10: Wait for IIS installation\necho \"Waiting for IIS installation to complete...\"\nsleep 120\n\n# Step 11: Create sample ASP.NET welcome page\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts @- <<'EOF'\n$htmlContent = @\"\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Azure HayMaker - IIS Server</title>\n    <style>\n        body { font-family: Segoe UI, sans-serif; margin: 50px; background: #f5f5f5; }\n        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }\n        h1 { color: #0078d4; }\n        .info { background: #f0f0f0; padding: 15px; border-left: 4px solid #0078d4; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Azure HayMaker - Windows IIS Server</h1>\n        <div class=\"info\">\n            <p><strong>Scenario:</strong> compute-02-windows-vm-iis</p>\n            <p><strong>Server Name:</strong> $env:COMPUTERNAME</p>\n            <p><strong>OS Version:</strong> Windows Server 2022 Datacenter</p>\n            <p><strong>IIS Version:</strong> 10.0</p>\n            <p><strong>Timestamp:</strong> $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')</p>\n            <p><strong>PowerShell Version:</strong> $($PSVersionTable.PSVersion.Major).$($PSVersionTable.PSVersion.Minor)</p>\n        </div>\n        <hr>\n        <p>This server is running on an Azure Windows VM with Internet Information Services (IIS) web server.</p>\n    </div>\n</body>\n</html>\n\"@\n\nSet-Content -Path \"C:\\inetpub\\wwwroot\\index.html\" -Value $htmlContent -Force\nEOF\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Verify Virtual Machine\naz vm show --resource-group \"${RESOURCE_GROUP}\" --name \"${VM_NAME}\" --query \"powerState\" -o tsv\n\n# Verify Network Interface\naz network nic show --resource-group \"${RESOURCE_GROUP}\" --name \"${NIC_NAME}\"\n\n# Verify Public IP\naz network public-ip show --resource-group \"${RESOURCE_GROUP}\" --name \"${PUBLIC_IP_NAME}\"\n\n# Verify Network Security Group Rules\naz network nsg rule list --resource-group \"${RESOURCE_GROUP}\" --nsg-name \"${NSG_NAME}\" --output table\n\n# Test HTTP connectivity\necho \"Testing HTTP connection to ${PUBLIC_IP}...\"\ncurl -I \"http://${PUBLIC_IP}\" || echo \"Note: May need to wait a moment for IIS to fully initialize\"\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Check VM CPU metrics\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Compute/virtualMachines/${VM_NAME}\" \\\n  --metric \"Percentage CPU\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 2: Check network metrics\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Compute/virtualMachines/${VM_NAME}\" \\\n  --metric \"Network In Total\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 3: Check IIS application pool status\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Get-IISAppPool\"\n\n# Operation 4: Check IIS websites\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Get-IISBindings\"\n\n# Operation 5: View IIS HTTP logs\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Get-ChildItem C:\\inetpub\\logs\\LogFiles\\W3SVC1\\ -Filter '*.log' | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | Get-Content -Tail 20\"\n\n# Operation 6: Stop and start the IIS service\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Stop-Service W3SVC; Start-Sleep -Seconds 5; Start-Service W3SVC; Get-Service W3SVC\"\n\n# Operation 7: Check Windows Update status\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Get-HotFix | Sort-Object InstalledOn -Descending | Select-Object -First 10\"\n\n# Operation 8: Get system information and performance metrics\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Write-Host 'System Information:'; Get-ComputerInfo -Property CsProcessors, CsPhysicalMemory, OsVersion; Write-Host 'Disk Space:'; Get-Volume | Select-Object DriveLetter, Size, SizeRemaining | Format-Table\"\n\n# Operation 9: Create a new IIS application pool\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"New-IISAppPool -Name 'HayMakerAppPool' -ErrorAction SilentlyContinue; Get-IISAppPool -Name 'HayMakerAppPool'\"\n\n# Operation 10: Add a new website binding\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"New-Item -Path 'C:\\inetpub\\wwwroot\\api' -ItemType Directory -Force | Out-Null; Set-Content -Path 'C:\\inetpub\\wwwroot\\api\\index.html' -Value '<h1>API Endpoint</h1><p>Test content</p>' -Force\"\n\n# Operation 11: Check IIS worker process status\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Get-Process w3wp | Select-Object ProcessName, Id, WorkingSet, Handles\"\n\n# Operation 12: Monitor disk usage\naz vm run-command invoke \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VM_NAME}\" \\\n  --command-id RunPowerShellScript \\\n  --scripts \"Get-Volume | Where-Object {$_.DriveLetter -ne $null} | Select-Object DriveLetter, Size, SizeRemaining, @{Name='PercentFree';Expression={[math]::Round(($_.SizeRemaining/$_.Size)*100,2)}} | Format-Table\"\n\n# Operation 13: Resize VM (scale up)\naz vm resize --resource-group \"${RESOURCE_GROUP}\" --name \"${VM_NAME}\" --size Standard_B4ms\n\n# Operation 14: Restart the VM\naz vm restart --resource-group \"${RESOURCE_GROUP}\" --name \"${VM_NAME}\" --no-wait\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete the entire resource group (includes VM, NICs, storage, etc.)\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 2: Wait for deletion to complete\necho \"Waiting for resource group deletion...\"\nsleep 120\n\n# Step 3: Verify deletion\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 4: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-compute-${UNIQUE_ID}-rg`\n- Virtual Machine: `azurehaymaker-winvm-${UNIQUE_ID}`\n- Network Interface: `azurehaymaker-winnic-${UNIQUE_ID}`\n- Network Security Group: `azurehaymaker-winnsg-${UNIQUE_ID}`\n- Virtual Network: `azurehaymaker-winvnet-${UNIQUE_ID}`\n- Public IP: `azurehaymaker-winpip-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Azure Virtual Machines Overview](https://learn.microsoft.com/en-us/azure/virtual-machines/overview)\n- [Create Windows Virtual Machine with Azure CLI](https://learn.microsoft.com/en-us/azure/virtual-machines/windows/quick-create-cli)\n- [Internet Information Services (IIS)](https://learn.microsoft.com/en-us/iis/get-started/introduction-to-iis/iis-overview)\n- [IIS PowerShell Module](https://learn.microsoft.com/en-us/powershell/module/iisadministration)\n- [Windows Server on Azure Virtual Machines](https://learn.microsoft.com/en-us/windows-server/remote/remote-desktop-services/rds-vms-on-azure)\n- [Azure VM Extensions](https://learn.microsoft.com/en-us/azure/virtual-machines/extensions/overview)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI with PowerShell\n\n**Rationale**: Azure CLI handles VM provisioning while PowerShell scripts enable granular Windows Server and IIS configuration management. This combination provides optimal control for Windows-based scenarios.\n\n---\n\n## Estimated Duration\n- **Deployment**: 20-25 minutes\n- **Operations Phase**: 8+ hours (with IIS management, performance monitoring, and maintenance)\n- **Cleanup**: 5-10 minutes\n\n---\n\n## Notes\n- Windows Server 2022 Datacenter edition provides latest features and support\n- IIS installed with comprehensive web server components including ASP.NET 4.8 support\n- RDP access available for remote desktop connections (port 3389)\n- Custom Script Extension used for automated IIS installation\n- PowerShell scripts used for advanced Windows Server management operations\n- All operations scoped to single tenant and subscription\n- Password generation ensures secure initial admin credentials (consider Azure Key Vault for production)\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 5 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Windows Server VM with IIS Web Server...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Windows Server VM with IIS Web Server...' is achieved"
    ],
    "constraints": []
  }
}
