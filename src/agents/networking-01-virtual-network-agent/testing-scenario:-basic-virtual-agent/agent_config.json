{
  "bundle_id": "0850acc2-c634-4f4f-a62e-a989e182a943",
  "name": "testing-scenario:-basic-virtual-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "planning",
      "test-design",
      "reporting",
      "analysis",
      "test-execution",
      "framework-setup",
      "automation",
      "test-coding"
    ],
    "skill_names": [
      "documenter",
      "tester"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: Basic Virtual Network with Subnets and Network Security\n\n## Objective\n# Scenario: Basic Virtual Network with Subnets and Network Security\n\n## Technology Area\nNetworking\n\n## Company Profile\n- **Company Size**: Small startup\n- **Industry**: Technology / SaaS\n- **Use Case**: Establish a secure foundation network infrastructure with isolated subnets for frontend and backend services\n\n## Scenario Description\nDeploy a foundational Azure Virtual Network with multiple subnets, configure network security groups with inbound and outbound rules, and implement route tables. This scenario covers VNet provisioning, subnet segmentation, network security policies, and traffic management for a multi-tier application architecture.\n\n## Azure Services Used\n- Azure Virtual Network\n- Azure Subnets\n- Azure Network Security Groups\n- Azure Route Tables\n- Azure Network Interface (for validation)\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed and configured\n- Basic understanding of IP addressing and CIDR notation\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-networking-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nVNET_NAME=\"azurehaymaker-vnet-${UNIQUE_ID}\"\nFRONTEND_SUBNET=\"azurehaymaker-frontend-${UNIQUE_ID}\"\nBACKEND_SUBNET=\"azurehaymaker-backend-${UNIQUE_ID}\"\nDATABASE_SUBNET=\"azurehaymaker-database-${UNIQUE_ID}\"\nFRONTEND_NSG=\"azurehaymaker-frontend-nsg-${UNIQUE_ID}\"\nBACKEND_NSG=\"azurehaymaker-backend-nsg-${UNIQUE_ID}\"\nDATABASE_NSG=\"azurehaymaker-database-nsg-${UNIQUE_ID}\"\nROUTE_TABLE=\"azurehaymaker-routes-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=networking-virtual-network Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Virtual Network with address space 10.0.0.0/16\naz network vnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VNET_NAME}\" \\\n  --address-prefix 10.0.0.0/16 \\\n  --tags ${TAGS}\n\n# Step 3: Create Frontend Subnet (10.0.1.0/24)\naz network vnet subnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${FRONTEND_SUBNET}\" \\\n  --address-prefix 10.0.1.0/24\n\n# Step 4: Create Backend Subnet (10.0.2.0/24)\naz network vnet subnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${BACKEND_SUBNET}\" \\\n  --address-prefix 10.0.2.0/24\n\n# Step 5: Create Database Subnet (10.0.3.0/24)\naz network vnet subnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${DATABASE_SUBNET}\" \\\n  --address-prefix 10.0.3.0/24\n\n# Step 6: Create Frontend Network Security Group\naz network nsg create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${FRONTEND_NSG}\" \\\n  --tags ${TAGS}\n\n# Step 7: Add Frontend NSG rules (allow HTTP, HTTPS from internet)\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${FRONTEND_NSG}\" \\\n  --name \"allow-http\" \\\n  --priority 1000 \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 80 \\\n  --access Allow \\\n  --protocol Tcp\n\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${FRONTEND_NSG}\" \\\n  --name \"allow-https\" \\\n  --priority 1001 \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 443 \\\n  --access Allow \\\n  --protocol Tcp\n\n# Step 8: Create Backend Network Security Group\naz network nsg create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${BACKEND_NSG}\" \\\n  --tags ${TAGS}\n\n# Step 9: Add Backend NSG rules (allow from frontend only)\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${BACKEND_NSG}\" \\\n  --name \"allow-from-frontend\" \\\n  --priority 1000 \\\n  --source-address-prefixes \"10.0.1.0/24\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 8080 8443 \\\n  --access Allow \\\n  --protocol Tcp\n\n# Step 10: Create Database Network Security Group\naz network nsg create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${DATABASE_NSG}\" \\\n  --tags ${TAGS}\n\n# Step 11: Add Database NSG rules (allow from backend only)\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${DATABASE_NSG}\" \\\n  --name \"allow-from-backend\" \\\n  --priority 1000 \\\n  --source-address-prefixes \"10.0.2.0/24\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges 5432 3306 1433 \\\n  --access Allow \\\n  --protocol Tcp\n\n# Step 12: Associate NSGs with subnets\naz network vnet subnet update \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${FRONTEND_SUBNET}\" \\\n  --network-security-group \"${FRONTEND_NSG}\"\n\naz network vnet subnet update \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${BACKEND_SUBNET}\" \\\n  --network-security-group \"${BACKEND_NSG}\"\n\naz network vnet subnet update \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${DATABASE_SUBNET}\" \\\n  --network-security-group \"${DATABASE_NSG}\"\n\n# Step 13: Create Route Table\naz network route-table create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${ROUTE_TABLE}\" \\\n  --tags ${TAGS}\n\n# Step 14: Associate Route Table with Backend subnet\naz network vnet subnet update \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-name \"${VNET_NAME}\" \\\n  --name \"${BACKEND_SUBNET}\" \\\n  --route-table \"${ROUTE_TABLE}\"\n```\n\n### Validation\n```bash\n# Verify Virtual Network\naz network vnet show --resource-group \"${RESOURCE_GROUP}\" --name \"${VNET_NAME}\"\n\n# List all subnets\naz network vnet subnet list --resource-group \"${RESOURCE_GROUP}\" --vnet-name \"${VNET_NAME}\" --output table\n\n# Verify Frontend NSG rules\naz network nsg rule list --resource-group \"${RESOURCE_GROUP}\" --nsg-name \"${FRONTEND_NSG}\" --output table\n\n# Verify Backend NSG rules\naz network nsg rule list --resource-group \"${RESOURCE_GROUP}\" --nsg-name \"${BACKEND_NSG}\" --output table\n\n# Verify Database NSG rules\naz network nsg rule list --resource-group \"${RESOURCE_GROUP}\" --nsg-name \"${DATABASE_NSG}\" --output table\n\n# Check Route Table association\naz network vnet subnet show --resource-group \"${RESOURCE_GROUP}\" --vnet-name \"${VNET_NAME}\" --name \"${BACKEND_SUBNET}\" --query \"routeTable\"\n\n# List all resources in resource group\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Create additional security rule for outbound traffic on Frontend\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${FRONTEND_NSG}\" \\\n  --name \"allow-outbound-backend\" \\\n  --priority 1002 \\\n  --direction Outbound \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"10.0.2.0/24\" \\\n  --destination-port-ranges \"*\" \\\n  --access Allow \\\n  --protocol \"*\"\n\n# Operation 2: Add custom route in route table (simulate routing to firewall)\naz network route-table route create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --route-table-name \"${ROUTE_TABLE}\" \\\n  --name \"route-to-monitoring\" \\\n  --address-prefix \"10.0.4.0/24\" \\\n  --next-hop-type VirtualAppliance \\\n  --next-hop-ip-address \"10.0.2.1\"\n\n# Operation 3: List all Network Security Groups\naz network nsg list --resource-group \"${RESOURCE_GROUP}\" --output table\n\n# Operation 4: Get detailed Network Security Group information\naz network nsg show --resource-group \"${RESOURCE_GROUP}\" --name \"${FRONTEND_NSG}\"\n\n# Operation 5: Check effective network security rules on Frontend subnet\naz network vnet subnet list-available-delegations --resource-group \"${RESOURCE_GROUP}\" --vnet-name \"${VNET_NAME}\" --subnet-name \"${FRONTEND_SUBNET}\"\n\n# Operation 6: View all routes in Route Table\naz network route-table route list --resource-group \"${RESOURCE_GROUP}\" --route-table-name \"${ROUTE_TABLE}\" --output table\n\n# Operation 7: Enable flow logs for monitoring (create storage account first)\nSTORAGE_ACCOUNT=\"azmkstorage${UNIQUE_ID}\"\naz storage account create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --location \"${LOCATION}\" \\\n  --sku Standard_LRS \\\n  --tags ${TAGS}\n\n# Operation 8: Create Network Watcher (if not exists)\naz network watcher configure --resource-group \"${RESOURCE_GROUP}\" --enabled true\n\n# Operation 9: Get VNet configuration summary\naz network vnet show --resource-group \"${RESOURCE_GROUP}\" --name \"${VNET_NAME}\" --query \"{name: name, addressSpace: addressSpace, subnets: subnets[*].name}\" -o json\n\n# Operation 10: Update NSG rule - modify Backend rule to allow SSH access\naz network nsg rule update \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${BACKEND_NSG}\" \\\n  --name \"allow-from-frontend\" \\\n  --destination-port-ranges \"22\" \"8080\" \"8443\"\n\n# Operation 11: Add rule to deny specific traffic on Database NSG\naz network nsg rule create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --nsg-name \"${DATABASE_NSG}\" \\\n  --name \"deny-all-inbound\" \\\n  --priority 4096 \\\n  --direction Inbound \\\n  --source-address-prefixes \"*\" \\\n  --source-port-ranges \"*\" \\\n  --destination-address-prefixes \"*\" \\\n  --destination-port-ranges \"*\" \\\n  --access Deny \\\n  --protocol \"*\"\n\n# Operation 12: List VNet peering (if any)\naz network vnet peering list --resource-group \"${RESOURCE_GROUP}\" --vnet-name \"${VNET_NAME}\" --output table\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete the entire resource group (includes VNet, subnets, NSGs, route tables, storage)\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 2: Wait for deletion to complete\necho \"Waiting for resource group deletion...\"\nsleep 120\n\n# Step 3: Verify deletion\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 4: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-networking-${UNIQUE_ID}-rg`\n- Virtual Network: `azurehaymaker-vnet-${UNIQUE_ID}`\n- Frontend Subnet: `azurehaymaker-frontend-${UNIQUE_ID}`\n- Backend Subnet: `azurehaymaker-backend-${UNIQUE_ID}`\n- Database Subnet: `azurehaymaker-database-${UNIQUE_ID}`\n- Frontend NSG: `azurehaymaker-frontend-nsg-${UNIQUE_ID}`\n- Backend NSG: `azurehaymaker-backend-nsg-${UNIQUE_ID}`\n- Database NSG: `azurehaymaker-database-nsg-${UNIQUE_ID}`\n- Route Table: `azurehaymaker-routes-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Azure Virtual Network Overview](https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview)\n- [Subnets and Address Spaces](https://learn.microsoft.com/en-us/azure/virtual-network/concepts-and-best-practices)\n- [Network Security Groups](https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview)\n- [Route Tables](https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview)\n- [Azure CLI Network Commands](https://learn.microsoft.com/en-us/cli/azure/network)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI\n\n**Rationale**: Azure CLI provides comprehensive network management capabilities with straightforward commands for VNet creation, subnet configuration, and security group management. The direct command approach is ideal for foundational network infrastructure scenarios.\n\n---\n\n## Estimated Duration\n- **Deployment**: 10-15 minutes\n- **Operations Phase**: 8+ hours (with monitoring, updates, and traffic management)\n- **Cleanup**: 5-10 minutes\n\n---\n\n## Notes\n- Virtual Network uses standard address space 10.0.0.0/16 with class C subnets\n- Network Security Groups follow the principle of least privilege (restrictive rules)\n- Subnets are logically segregated by tier (frontend, backend, database)\n- Route Tables enable custom routing for advanced network scenarios\n- All operations scoped to single tenant and subscription\n- NSG rules can be easily updated for changes to security policies\n- Storage account created for potential flow logs monitoring\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Basic Virtual Network with Subnets and N...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Basic Virtual Network with Subnets and N...' is achieved"
    ],
    "constraints": []
  }
}
