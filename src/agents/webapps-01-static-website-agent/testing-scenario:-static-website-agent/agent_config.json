{
  "bundle_id": "bf6db498-74ff-4273-b312-9bd4ab799606",
  "name": "testing-scenario:-static-website-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "analysis",
      "test-execution",
      "reporting",
      "framework-setup",
      "test-design",
      "test-coding",
      "planning",
      "automation"
    ],
    "skill_names": [
      "documenter",
      "tester"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: Static Website with Azure Storage and CDN\n\n## Objective\n# Scenario: Static Website with Azure Storage and CDN\n\n## Technology Area\nWeb Apps\n\n## Company Profile\n- **Company Size**: Small design agency\n- **Industry**: Creative Services / Marketing\n- **Use Case**: Host static portfolio websites for clients with global CDN for fast loading\n\n## Scenario Description\nDeploy a static HTML/CSS/JS website to Azure Storage static website hosting, configure Azure CDN for global distribution, and set up custom domain with HTTPS. Perfect for portfolio sites, documentation, or landing pages.\n\n## Azure Services Used\n- Azure Storage Account (Static Website Hosting)\n- Azure CDN (Content Delivery Network)\n- Azure DNS (for custom domain - optional)\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed\n- Sample static website files\n- A unique identifier for this scenario run\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-webapp-static-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nSTORAGE_ACCOUNT=\"azmkrweb${UNIQUE_ID}\"\nCDN_PROFILE=\"azurehaymaker-cdn-${UNIQUE_ID}\"\nCDN_ENDPOINT=\"azurehaymaker-endpoint-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=webapps-static-website Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Storage Account\naz storage account create \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --sku Standard_LRS \\\n  --kind StorageV2 \\\n  --tags ${TAGS}\n\n# Step 3: Enable static website hosting\naz storage blob service-properties update \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --static-website \\\n  --404-document \"404.html\" \\\n  --index-document \"index.html\"\n\n# Step 4: Get storage account key\nSTORAGE_KEY=$(az storage account keys list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --query '[0].value' -o tsv)\n\n# Step 5: Create sample website files\nmkdir -p /tmp/website\ncat > /tmp/website/index.html <<EOF\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Azure HayMaker Portfolio</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n</head>\n<body>\n    <header>\n        <h1>Azure HayMaker Portfolio Site</h1>\n        <p>Static Website Hosting Demo</p>\n    </header>\n    <main>\n        <section>\n            <h2>Welcome</h2>\n            <p>This is a sample static website hosted on Azure Storage with CDN.</p>\n            <p>Scenario: webapps-static-website</p>\n            <p>Timestamp: $(date)</p>\n        </section>\n    </main>\n    <footer>\n        <p>&copy; 2024 Azure HayMaker</p>\n    </footer>\n</body>\n</html>\nEOF\n\ncat > /tmp/website/styles.css <<EOF\nbody {\n    font-family: Arial, sans-serif;\n    max-width: 800px;\n    margin: 0 auto;\n    padding: 20px;\n    background-color: #f5f5f5;\n}\nheader {\n    background-color: #0078d4;\n    color: white;\n    padding: 20px;\n    border-radius: 5px;\n    margin-bottom: 20px;\n}\nh1 { margin: 0; }\nsection {\n    background: white;\n    padding: 20px;\n    border-radius: 5px;\n    margin-bottom: 20px;\n}\nfooter {\n    text-align: center;\n    padding: 20px;\n    color: #666;\n}\nEOF\n\ncat > /tmp/website/404.html <<EOF\n<!DOCTYPE html>\n<html>\n<head>\n    <title>404 - Page Not Found</title>\n</head>\n<body>\n    <h1>404 - Page Not Found</h1>\n    <p>The page you're looking for doesn't exist.</p>\n    <a href=\"/\">Go to homepage</a>\n</body>\n</html>\nEOF\n\n# Step 6: Upload website files to $web container\naz storage blob upload-batch \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --destination '$web' \\\n  --source /tmp/website \\\n  --overwrite\n\n# Step 7: Get the static website URL\nWEBSITE_URL=$(az storage account show \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"primaryEndpoints.web\" -o tsv)\n\necho \"Static Website URL: ${WEBSITE_URL}\"\n\n# Step 8: Create CDN Profile\naz cdn profile create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${CDN_PROFILE}\" \\\n  --sku Standard_Microsoft \\\n  --location \"global\" \\\n  --tags ${TAGS}\n\n# Step 9: Create CDN Endpoint\n# Extract hostname from website URL (remove https:// and trailing /)\nORIGIN_HOSTNAME=$(echo \"${WEBSITE_URL}\" | sed 's|https://||' | sed 's|/$||')\n\naz cdn endpoint create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\" \\\n  --origin \"${ORIGIN_HOSTNAME}\" \\\n  --origin-host-header \"${ORIGIN_HOSTNAME}\" \\\n  --enable-compression \\\n  --content-types-to-compress \"text/html\" \"text/css\" \"application/javascript\" \"application/json\" \\\n  --tags ${TAGS}\n\n# Step 10: Get CDN endpoint URL\nCDN_URL=$(az cdn endpoint show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\" \\\n  --query \"hostName\" -o tsv)\n\necho \"\"\necho \"==========================================\"\necho \"Website Deployment Complete!\"\necho \"Storage Website: ${WEBSITE_URL}\"\necho \"CDN Endpoint: https://${CDN_URL}\"\necho \"==========================================\"\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Verify Storage Account\naz storage account show --name \"${STORAGE_ACCOUNT}\" --resource-group \"${RESOURCE_GROUP}\"\n\n# Check static website is enabled\naz storage blob service-properties show \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\"\n\n# List files in $web container\naz storage blob list \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --container-name '$web' \\\n  --output table\n\n# Verify CDN Profile\naz cdn profile show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${CDN_PROFILE}\"\n\n# Verify CDN Endpoint\naz cdn endpoint show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\"\n\n# Test website accessibility\ncurl -s \"${WEBSITE_URL}\" | grep \"Azure HayMaker\"\necho \"If you see HTML output above, the website is accessible!\"\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Update website content\ncat > /tmp/website/index.html <<EOF\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Azure HayMaker Portfolio - Updated</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n</head>\n<body>\n    <header>\n        <h1>Azure HayMaker Portfolio Site - UPDATED</h1>\n        <p>Version 2.0 - Last updated: $(date)</p>\n    </header>\n    <main>\n        <section>\n            <h2>Latest Updates</h2>\n            <p>This website has been updated with new content!</p>\n            <ul>\n                <li>Enhanced design</li>\n                <li>New sections added</li>\n                <li>Performance optimized</li>\n            </ul>\n        </section>\n    </main>\n    <footer>\n        <p>&copy; 2024 Azure HayMaker</p>\n    </footer>\n</body>\n</html>\nEOF\n\naz storage blob upload \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --container-name '$web' \\\n  --name \"index.html\" \\\n  --file /tmp/website/index.html \\\n  --overwrite\n\n# Operation 2: Purge CDN cache to see updates immediately\naz cdn endpoint purge \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\" \\\n  --content-paths \"/*\"\n\n# Operation 3: Add new page to website\ncat > /tmp/website/about.html <<EOF\n<!DOCTYPE html>\n<html>\n<head>\n    <title>About Us</title>\n    <link rel=\"stylesheet\" href=\"styles.css\">\n</head>\n<body>\n    <header><h1>About Azure HayMaker</h1></header>\n    <main>\n        <section>\n            <p>This is the about page.</p>\n        </section>\n    </main>\n    <footer><a href=\"/\">Home</a></footer>\n</body>\n</html>\nEOF\n\naz storage blob upload \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --container-name '$web' \\\n  --name \"about.html\" \\\n  --file /tmp/website/about.html\n\n# Operation 4: Monitor CDN metrics\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Cdn/profiles/${CDN_PROFILE}/endpoints/${CDN_ENDPOINT}\" \\\n  --metric \"BytesSentPerRequest\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ')\n\n# Operation 5: Check CDN endpoint status\naz cdn endpoint show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\" \\\n  --query \"resourceState\" -o tsv\n\n# Operation 6: Enable custom domain (example - requires actual domain)\necho \"To add custom domain:\"\necho \"az cdn custom-domain create --resource-group \\\"${RESOURCE_GROUP}\\\" --profile-name \\\"${CDN_PROFILE}\\\" --endpoint-name \\\"${CDN_ENDPOINT}\\\" --name \\\"myCustomDomain\\\" --hostname \\\"www.example.com\\\"\"\n\n# Operation 7: Configure caching rules\naz cdn endpoint rule add \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\" \\\n  --order 1 \\\n  --rule-name \"CacheImages\" \\\n  --match-variable RequestUri \\\n  --operator Contains \\\n  --match-values \".jpg\" \".png\" \".gif\" \\\n  --action-name CacheExpiration \\\n  --cache-behavior Override \\\n  --cache-duration \"7.00:00:00\"\n\n# Operation 8: List all blobs in website\naz storage blob list \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --container-name '$web' \\\n  --output table\n\n# Operation 9: Download website for backup\naz storage blob download-batch \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --source '$web' \\\n  --destination /tmp/website-backup\n\n# Operation 10: Monitor storage account usage\naz storage account show-usage \\\n  --location \"${LOCATION}\"\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete CDN endpoint first (takes longest)\naz cdn endpoint delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --profile-name \"${CDN_PROFILE}\" \\\n  --name \"${CDN_ENDPOINT}\" \\\n  --yes\n\n# Step 2: Delete CDN profile\naz cdn profile delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${CDN_PROFILE}\" \\\n  --yes\n\n# Step 3: Delete the entire resource group (includes storage account)\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 4: Verify deletion\nsleep 60\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 5: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n\n# Step 6: Clean up local temp files\nrm -rf /tmp/website /tmp/website-backup\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-webapp-static-${UNIQUE_ID}-rg`\n- Storage Account: `azmkrweb${UNIQUE_ID}`\n- CDN Profile: `azurehaymaker-cdn-${UNIQUE_ID}`\n- CDN Endpoint: `azurehaymaker-endpoint-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Static website hosting in Azure Storage](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website)\n- [Azure CDN Overview](https://learn.microsoft.com/en-us/azure/cdn/cdn-overview)\n- [Use Azure CDN with Azure Storage](https://learn.microsoft.com/en-us/azure/cdn/cdn-create-a-storage-account-with-cdn)\n- [Azure Storage CLI Reference](https://learn.microsoft.com/en-us/cli/azure/storage)\n- [Azure CDN CLI Reference](https://learn.microsoft.com/en-us/cli/azure/cdn)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI\n\n**Rationale**: Azure CLI provides excellent support for both Azure Storage static websites and Azure CDN. The commands are straightforward and well-documented. Terraform is also viable for infrastructure-as-code, but Azure CLI is simpler for this scenario.\n\n---\n\n## Estimated Duration\n- **Deployment**: 10-15 minutes\n- **Operations Phase**: 8 hours (with periodic content updates and cache purges)\n- **Cleanup**: 5-10 minutes (CDN deletion takes a few minutes)\n\n---\n\n## Notes\n- Static website hosting is very cost-effective (pennies per month)\n- CDN provides global distribution with edge caching\n- HTTPS is automatic for both storage and CDN endpoints\n- Custom domains require DNS configuration (CNAME record)\n- CDN cache purge may take a few minutes to propagate globally\n- All operations scoped to single tenant and subscription\n- Perfect for JAMstack applications, documentation sites, SPAs\n- Storage account must be v2 (StorageV2) for static website feature\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Static Website with Azure Storage and CD...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Static Website with Azure Storage and CD...' is achieved"
    ],
    "constraints": []
  }
}
