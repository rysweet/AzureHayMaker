{
  "bundle_id": "eb34f7bd-071b-40f5-be30-6a0d5dd345ff",
  "name": "testing-scenario:-azure-migrate-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "analysis",
      "planning",
      "automation",
      "test-coding",
      "test-design",
      "test-execution",
      "framework-setup",
      "reporting"
    ],
    "skill_names": [
      "documenter",
      "tester"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: Azure Migrate Assessment and Discovery\n\n## Objective\n# Scenario: Azure Migrate Assessment and Discovery\n\n## Technology Area\nHybrid+Multicloud\n\n## Company Profile\n- **Company Size**: Large enterprise\n- **Industry**: Healthcare\n- **Use Case**: Assess on-premises infrastructure for cloud migration readiness\n\n## Scenario Description\nDeploy Azure Migrate to discover on-premises infrastructure, assess migration readiness, and create migration plans. Configure assessment tools, analyze dependencies, and generate migration recommendations.\n\n## Azure Services Used\n- Azure Migrate (migration assessment and orchestration)\n- Azure Migrate: Server Assessment (readiness assessment)\n- Azure Migrate: Database Assessment (database evaluation)\n- Azure Key Vault (credentials storage)\n\n## Prerequisites\n- Azure subscription with Contributor role\n- Azure CLI installed\n- A unique identifier for this scenario run\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-hybrid-migrate-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nMIGRATE_PROJECT=\"azurehaymaker-migrate-${UNIQUE_ID}\"\nSTORAGE_ACCOUNT=\"azmkrmigrate${UNIQUE_ID}\"\nKEYVAULT=\"azurehaymaker-kv-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=hybrid-azure-migrate Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Storage Account for migration data\naz storage account create \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --sku Standard_LRS \\\n  --kind StorageV2 \\\n  --tags ${TAGS}\n\n# Step 3: Create containers for assessment data\nSTORAGE_KEY=$(az storage account keys list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --query '[0].value' -o tsv)\n\naz storage container create \\\n  --name \"discovery-data\" \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\"\n\naz storage container create \\\n  --name \"assessment-results\" \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\"\n\naz storage container create \\\n  --name \"migration-artifacts\" \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\"\n\n# Step 4: Create Key Vault\naz keyvault create \\\n  --name \"${KEYVAULT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 5: Create Azure Migrate Project\naz migrate project create \\\n  --name \"${MIGRATE_PROJECT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 6: Get project details\nPROJECT_ID=$(az migrate project show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${MIGRATE_PROJECT}\" \\\n  --query \"id\" -o tsv)\n\n# Step 7: Create sample discovery data\ncat > /tmp/discovered_servers.json <<EOF\n{\n  \"servers\": [\n    {\n      \"id\": \"server-001\",\n      \"name\": \"web-server-01\",\n      \"os\": \"Windows Server 2019\",\n      \"cpu\": 8,\n      \"memory\": 32,\n      \"storage\": 500,\n      \"network\": [\"10.0.1.10\"],\n      \"applications\": [\"IIS\", \".NET Framework\", \"SQL Server Express\"]\n    },\n    {\n      \"id\": \"server-002\",\n      \"name\": \"app-server-01\",\n      \"os\": \"Windows Server 2019\",\n      \"cpu\": 16,\n      \"memory\": 64,\n      \"storage\": 1000,\n      \"network\": [\"10.0.1.11\"],\n      \"applications\": [\"App Service\", \".NET 4.8\", \"Custom App\"]\n    },\n    {\n      \"id\": \"server-003\",\n      \"name\": \"db-server-01\",\n      \"os\": \"Windows Server 2019\",\n      \"cpu\": 32,\n      \"memory\": 128,\n      \"storage\": 2000,\n      \"network\": [\"10.0.1.12\"],\n      \"applications\": [\"SQL Server 2019\"]\n    },\n    {\n      \"id\": \"server-004\",\n      \"name\": \"file-server-01\",\n      \"os\": \"Windows Server 2016\",\n      \"cpu\": 4,\n      \"memory\": 16,\n      \"storage\": 5000,\n      \"network\": [\"10.0.1.13\"],\n      \"applications\": [\"File Share\", \"DFS\"]\n    }\n  ]\n}\nEOF\n\n# Step 8: Create assessment group\ncat > /tmp/assessment_group.json <<EOF\n{\n  \"groupName\": \"production-servers\",\n  \"groupType\": \"Default\",\n  \"description\": \"Production servers for migration assessment\",\n  \"servers\": [\"server-001\", \"server-002\", \"server-003\"],\n  \"properties\": {\n    \"environment\": \"production\",\n    \"priority\": \"high\"\n  }\n}\nEOF\n\n# Step 9: Create assessment configuration\ncat > /tmp/assessment_config.json <<EOF\n{\n  \"assessmentName\": \"production-assessment\",\n  \"groupName\": \"production-servers\",\n  \"computeOptions\": {\n    \"isPerformanceBased\": true,\n    \"computeComfort\": 1.5,\n    \"cpuUtilizationPercentile\": 95,\n    \"memoryUtilizationPercentile\": 95\n  },\n  \"storageOptions\": {\n    \"storageRedundancy\": \"LocallyRedundant\",\n    \"discType\": \"PremiumManagedDisk\"\n  },\n  \"networkOptions\": {\n    \"networkSecurityGroupOption\": \"UserManaged\"\n  },\n  \"azureOptions\": {\n    \"azureOfferCode\": \"MSAZR0003P\",\n    \"currency\": \"USD\",\n    \"discountPercentage\": 0,\n    \"azureHybridUseBenefit\": \"Yes\"\n  }\n}\nEOF\n\n# Step 10: Store assessment configuration\naz keyvault secret set \\\n  --vault-name \"${KEYVAULT}\" \\\n  --name \"discovered-servers\" \\\n  --value @/tmp/discovered_servers.json\n\naz keyvault secret set \\\n  --vault-name \"${KEYVAULT}\" \\\n  --name \"assessment-config\" \\\n  --value @/tmp/assessment_config.json\n\necho \"\"\necho \"==========================================\"\necho \"Azure Migrate Project: ${MIGRATE_PROJECT}\"\necho \"Resource Group: ${RESOURCE_GROUP}\"\necho \"Storage Account: ${STORAGE_ACCOUNT}\"\necho \"==========================================\"\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Show Migrate Project\naz migrate project show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${MIGRATE_PROJECT}\"\n\n# Check project status\naz migrate project show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${MIGRATE_PROJECT}\" \\\n  --query \"createdTimestamp\" -o tsv\n\n# List projects\naz migrate project list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --output table\n\n# Verify Storage Account\naz storage account show \\\n  --name \"${STORAGE_ACCOUNT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\"\n\n# List storage containers\naz storage container list \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --output table\n\n# Check Key Vault\naz keyvault show --name \"${KEYVAULT}\"\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Create assessment group\necho \"To create assessment groups:\"\necho \"Servers are organized by group for targeted assessment and migration planning\"\n\n# Operation 2: Generate migration readiness assessment\ncat > /tmp/readiness_assessment.json <<EOF\n{\n  \"assessmentResults\": {\n    \"server-001\": {\n      \"readiness\": \"Ready\",\n      \"recommendedSize\": \"Standard_D4s_v3\",\n      \"estimatedMonthlyCost\": 200\n    },\n    \"server-002\": {\n      \"readiness\": \"Ready with Conditions\",\n      \"recommendedSize\": \"Standard_D8s_v3\",\n      \"estimatedMonthlyCost\": 400,\n      \"conditions\": [\"Requires Extended Support\", \"Network bandwidth optimization\"]\n    },\n    \"server-003\": {\n      \"readiness\": \"Ready\",\n      \"recommendedSize\": \"Standard_E16s_v3\",\n      \"estimatedMonthlyCost\": 800,\n      \"notes\": \"SQL Server licensing included\"\n    },\n    \"server-004\": {\n      \"readiness\": \"Needs Assessment\",\n      \"recommendedSize\": \"Standard_D2s_v3\",\n      \"estimatedMonthlyCost\": 100,\n      \"conditions\": [\"Large storage migration required\"]\n    }\n  }\n}\nEOF\n\n# Operation 3: Analyze dependencies\ncat > /tmp/dependency_analysis.json <<EOF\n{\n  \"dependencies\": [\n    {\n      \"source\": \"web-server-01\",\n      \"target\": \"app-server-01\",\n      \"protocol\": \"HTTP\",\n      \"port\": 8080,\n      \"traffic\": \"High\"\n    },\n    {\n      \"source\": \"app-server-01\",\n      \"target\": \"db-server-01\",\n      \"protocol\": \"TDS\",\n      \"port\": 1433,\n      \"traffic\": \"Very High\"\n    },\n    {\n      \"source\": \"app-server-01\",\n      \"target\": \"file-server-01\",\n      \"protocol\": \"SMB\",\n      \"port\": 445,\n      \"traffic\": \"Medium\"\n    }\n  ]\n}\nEOF\n\n# Operation 4: Create migration plan\ncat > /tmp/migration_plan.json <<EOF\n{\n  \"phases\": [\n    {\n      \"phase\": 1,\n      \"name\": \"Assessment and Preparation\",\n      \"duration\": \"2-4 weeks\",\n      \"tasks\": [\n        \"Detailed application assessment\",\n        \"Network design review\",\n        \"Compliance requirements analysis\"\n      ]\n    },\n    {\n      \"phase\": 2,\n      \"name\": \"Pilot Migration\",\n      \"duration\": \"1-2 weeks\",\n      \"servers\": [\"file-server-01\"],\n      \"tasks\": [\n        \"Test migration process\",\n        \"Validate performance\",\n        \"Identify issues\"\n      ]\n    },\n    {\n      \"phase\": 3,\n      \"name\": \"Production Migration\",\n      \"duration\": \"3-4 weeks\",\n      \"servers\": [\"web-server-01\", \"app-server-01\", \"db-server-01\"],\n      \"tasks\": [\n        \"Migrate production servers\",\n        \"Cutover traffic\",\n        \"Decommission on-premises\"\n      ]\n    }\n  ]\n}\nEOF\n\n# Operation 5: Monitor assessment progress\naz migrate project show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${MIGRATE_PROJECT}\" \\\n  --query \"createdTimestamp\" -o tsv\n\n# Operation 6: Generate cost analysis\necho \"Cost Analysis for Migration:\"\necho \"- Web Server: \\$200/month\"\necho \"- App Server: \\$400/month\"\necho \"- Database Server: \\$800/month\"\necho \"- File Server: \\$100/month\"\necho \"- Total Estimated: \\$1,500/month\"\n\n# Operation 7: Create replication schedule\ncat > /tmp/replication_schedule.json <<EOF\n{\n  \"schedule\": {\n    \"discovery\": \"Continuous\",\n    \"assessment\": \"Weekly\",\n    \"costAnalysis\": \"Monthly\",\n    \"refreshInterval\": \"24 hours\"\n  }\n}\nEOF\n\n# Operation 8: Update project properties\naz migrate project update \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${MIGRATE_PROJECT}\" \\\n  --tags Environment=production Phase=assessment 2>/dev/null || true\n\n# Operation 9: Export assessment results\naz storage blob upload \\\n  --account-name \"${STORAGE_ACCOUNT}\" \\\n  --account-key \"${STORAGE_KEY}\" \\\n  --container-name \"assessment-results\" \\\n  --name \"readiness-assessment.json\" \\\n  --file /tmp/readiness_assessment.json\n\n# Operation 10: Generate migration report\necho \"Azure Migrate Assessment Report Generated\"\necho \"- Servers Assessed: 4\"\necho \"- Ready for Migration: 3\"\necho \"- Needs Assessment: 1\"\necho \"- Total Estimated Annual Cost: \\$18,000\"\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete Migrate Project\naz migrate project delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${MIGRATE_PROJECT}\" \\\n  --yes 2>/dev/null || true\n\n# Step 2: Delete the entire resource group\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 3: Verify deletion\nsleep 60\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 4: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n\n# Step 5: Clean up local files\nrm -rf /tmp/discovered_servers.json /tmp/assessment_*.json /tmp/readiness_assessment.json /tmp/dependency_analysis.json /tmp/migration_plan.json /tmp/replication_schedule.json\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-hybrid-migrate-${UNIQUE_ID}-rg`\n- Migrate Project: `azurehaymaker-migrate-${UNIQUE_ID}`\n- Storage Account: `azmkrmigrate${UNIQUE_ID}`\n- Key Vault: `azurehaymaker-kv-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [Azure Migrate Overview](https://learn.microsoft.com/en-us/azure/migrate/migrate-services-overview)\n- [Azure Migrate Appliance](https://learn.microsoft.com/en-us/azure/migrate/migrate-appliance)\n- [Server Assessment](https://learn.microsoft.com/en-us/azure/migrate/concepts-assessment-calculation)\n- [Dependency Analysis](https://learn.microsoft.com/en-us/azure/migrate/concepts-dependency-visualization)\n- [Azure Migrate CLI Reference](https://learn.microsoft.com/en-us/cli/azure/migrate)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI + Analysis Tools\n\n**Rationale**: Azure CLI manages Migrate project lifecycle while analysis tools process discovery data for comprehensive assessment.\n\n---\n\n## Estimated Duration\n- **Deployment**: 10-15 minutes\n- **Operations Phase**: 8 hours (with assessments and analysis)\n- **Cleanup**: 5 minutes\n\n---\n\n## Notes\n- Azure Migrate appliance performs continuous discovery\n- Agentless discovery available for VMware environments\n- Agent-based discovery for detailed application inventory\n- Dependency mapping shows application relationships\n- Assessment provides sizing and cost estimates\n- All operations scoped to single tenant and subscription\n- Supports wave-based migration planning\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: Azure Migrate Assessment and Discovery...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: Azure Migrate Assessment and Discovery...' is achieved"
    ],
    "constraints": []
  }
}
