{
  "bundle_id": "1003fd1b-4bd8-4473-9010-abed9877ef6e",
  "name": "testing-scenario:-expressroute-private-agent",
  "version": "1.0.0",
  "metadata": {
    "domain": "testing",
    "complexity": "complex",
    "phase_count": 4,
    "skill_count": 2,
    "estimated_duration": "2 hours 36 minutes",
    "required_capabilities": [
      "analysis",
      "test-design",
      "planning",
      "reporting",
      "test-coding",
      "test-execution",
      "automation",
      "framework-setup"
    ],
    "skill_names": [
      "tester",
      "documenter"
    ],
    "parallel_opportunities": 0,
    "risk_factors": [
      "High complexity may require extended execution time"
    ]
  },
  "auto_mode_config": {
    "max_turns": 18,
    "initial_prompt": "# Goal: Scenario: ExpressRoute Private Connectivity\n\n## Objective\n# Scenario: ExpressRoute Private Connectivity\n\n## Technology Area\nHybrid+Multicloud\n\n## Company Profile\n- **Company Size**: Large enterprise\n- **Industry**: Financial Services\n- **Use Case**: Establish dedicated private connection from on-premises to Azure\n\n## Scenario Description\nDeploy Azure ExpressRoute to create a private, dedicated network connection between on-premises infrastructure and Azure. Configure peering, monitor circuit health, and implement traffic management.\n\n## Azure Services Used\n- Azure ExpressRoute (dedicated connectivity)\n- Azure Virtual Network (cloud network)\n- Azure Route Server (dynamic routing)\n- Azure Monitor (health monitoring)\n\n## Prerequisites\n- Azure subscription with appropriate permissions\n- Azure CLI installed\n- A unique identifier for this scenario run\n\n---\n\n## Phase 1: Deployment and Validation\n\n### Environment Setup\n```bash\n# Set variables\nUNIQUE_ID=$(date +%Y%m%d%H%M%S)\nRESOURCE_GROUP=\"azurehaymaker-hybrid-expressroute-${UNIQUE_ID}-rg\"\nLOCATION=\"eastus\"\nEXPRESSROUTE_CIRCUIT=\"azurehaymaker-er-${UNIQUE_ID}\"\nEXPRESSROUTE_GATEWAY=\"azurehaymaker-ergw-${UNIQUE_ID}\"\nVNET_NAME=\"azurehaymaker-vnet-${UNIQUE_ID}\"\nKEYVAULT=\"azurehaymaker-kv-${UNIQUE_ID}\"\n\n# Tags\nTAGS=\"AzureHayMaker-managed=true Scenario=hybrid-expressroute Owner=AzureHayMaker\"\n```\n\n### Deployment Steps\n```bash\n# Step 1: Create Resource Group\naz group create \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 2: Create Virtual Network\naz network vnet create \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VNET_NAME}\" \\\n  --address-prefix \"10.0.0.0/16\" \\\n  --subnet-name \"gateway-subnet\" \\\n  --subnet-prefixes \"10.0.0.0/27\" \\\n  --tags ${TAGS}\n\n# Step 3: Create Key Vault for storing secrets\naz keyvault create \\\n  --name \"${KEYVAULT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --tags ${TAGS}\n\n# Step 4: Create ExpressRoute circuit\naz network express-route create \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --location \"${LOCATION}\" \\\n  --bandwidth 50 \\\n  --provider \"Equinix\" \\\n  --peering-location \"San Jose\" \\\n  --sku-family MeteredData \\\n  --sku-tier Standard \\\n  --tags ${TAGS}\n\n# Step 5: Get circuit provisioning key\nCIRCUIT_KEY=$(az network express-route show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --query \"serviceKey\" -o tsv)\n\n# Store in Key Vault\naz keyvault secret set \\\n  --vault-name \"${KEYVAULT}\" \\\n  --name \"expressroute-service-key\" \\\n  --value \"${CIRCUIT_KEY}\"\n\n# Step 6: Create ExpressRoute gateway\naz network vnet-gateway create \\\n  --name \"${EXPRESSROUTE_GATEWAY}\" \\\n  --location \"${LOCATION}\" \\\n  --public-ip-address-allocation static \\\n  --vnet \"${VNET_NAME}\" \\\n  --gateway-type ExpressRoute \\\n  --sku Standard \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --tags ${TAGS}\n\n# Step 7: Configure private peering\ncat > /tmp/peering_config.json <<EOF\n{\n  \"peeringConfiguration\": {\n    \"peeringType\": \"AzurePrivatePeering\",\n    \"primaryPeerAddressPrefix\": \"192.168.1.0/30\",\n    \"secondaryPeerAddressPrefix\": \"192.168.2.0/30\",\n    \"vlanId\": 100,\n    \"customerASN\": 65000,\n    \"routerASN\": 12076\n  }\n}\nEOF\n\n# Step 8: Create Azure peering\naz network express-route peering create \\\n  --circuit-name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --name \"AzurePrivatePeering\" \\\n  --peer-asn 65000 \\\n  --primary-peer-subnet \"192.168.1.0/30\" \\\n  --secondary-peer-subnet \"192.168.2.0/30\" \\\n  --vlan-id 100 \\\n  --resource-group \"${RESOURCE_GROUP}\"\n\n# Step 9: Create gateway connection\nGATEWAY_ID=$(az network vnet-gateway show \\\n  --name \"${EXPRESSROUTE_GATEWAY}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"id\" -o tsv)\n\nCIRCUIT_ID=$(az network express-route show \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"id\" -o tsv)\n\naz network vpn-connection create \\\n  --name \"ExpressRoute-Connection\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --vnet-gateway1 \"${EXPRESSROUTE_GATEWAY}\" \\\n  --express-route-circuit2 \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --connection-type ExpressRoute \\\n  --tags ${TAGS}\n\n# Step 10: Create diagnostic settings\naz monitor diagnostic-settings create \\\n  --name \"expressroute-diagnostics\" \\\n  --resource \"${CIRCUIT_ID}\" \\\n  --logs '[{\"category\":\"ExpressRouteSiteToSiteVpnConnection\",\"enabled\":true}]' \\\n  --metrics '[{\"category\":\"AllMetrics\",\"enabled\":true}]' 2>/dev/null || echo \"Diagnostics will be available after provisioning\"\n\necho \"\"\necho \"==========================================\"\necho \"ExpressRoute Circuit: ${EXPRESSROUTE_CIRCUIT}\"\necho \"Service Key: ${CIRCUIT_KEY}\"\necho \"Gateway: ${EXPRESSROUTE_GATEWAY}\"\necho \"==========================================\"\n```\n\n### Validation\n```bash\n# Verify Resource Group\naz group show --name \"${RESOURCE_GROUP}\"\n\n# Show ExpressRoute circuit details\naz network express-route show \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\"\n\n# Check circuit provisioning state\naz network express-route show \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"circuitProvisioningState\" -o tsv\n\n# List peerings\naz network express-route peering list \\\n  --circuit-name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --output table\n\n# Show gateway\naz network vnet-gateway show \\\n  --name \"${EXPRESSROUTE_GATEWAY}\" \\\n  --resource-group \"${RESOURCE_GROUP}\"\n\n# List connections\naz network vpn-connection list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --output table\n\n# Check Virtual Network\naz network vnet show \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${VNET_NAME}\"\n\n# List all resources\naz resource list --resource-group \"${RESOURCE_GROUP}\" --output table\n```\n\n---\n\n## Phase 2: Mid-Day Operations and Management\n\n### Management Operations\n```bash\n# Operation 1: Monitor circuit status\naz network express-route show \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"{ProvisioningState:circuitProvisioningState, ServiceProviderProvisioningState:serviceProviderProvisioningState}\" -o table\n\n# Operation 2: Get circuit stats\naz network express-route stats show \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --peering-name \"AzurePrivatePeering\" 2>/dev/null || echo \"Stats not yet available\"\n\n# Operation 3: Configure Route Server (optional)\ncat > /tmp/route_server_config.json <<EOF\n{\n  \"routeServerConfiguration\": {\n    \"name\": \"route-server-1\",\n    \"asn\": 65515,\n    \"subnetPrefix\": \"10.0.1.0/27\"\n  }\n}\nEOF\n\n# Operation 4: Monitor connection health\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Network/expressRouteCircuits/${EXPRESSROUTE_CIRCUIT}\" \\\n  --metric \"BitsInPerSecond\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ') 2>/dev/null || echo \"Metrics not yet available\"\n\n# Operation 5: Check BGP sessions\necho \"To verify BGP sessions:\"\necho \"az network express-route peering show --circuit-name ${EXPRESSROUTE_CIRCUIT} --name AzurePrivatePeering --resource-group ${RESOURCE_GROUP}\"\n\n# Operation 6: View peering details\naz network express-route peering show \\\n  --circuit-name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --name \"AzurePrivatePeering\" \\\n  --resource-group \"${RESOURCE_GROUP}\" 2>/dev/null || echo \"Peering details not available\"\n\n# Operation 7: Configure QoS settings\ncat > /tmp/qos_config.json <<EOF\n{\n  \"qosConfiguration\": {\n    \"inboundBandwidthMbps\": 50,\n    \"outboundBandwidthMbps\": 50,\n    \"priorityMapping\": {\n      \"businessCritical\": 1,\n      \"important\": 2,\n      \"standard\": 3\n    }\n  }\n}\nEOF\n\n# Operation 8: Monitor circuit utilization\naz monitor metrics list \\\n  --resource \"/subscriptions/$(az account show --query id -o tsv)/resourceGroups/${RESOURCE_GROUP}/providers/Microsoft.Network/expressRouteCircuits/${EXPRESSROUTE_CIRCUIT}\" \\\n  --metric \"BitsOutPerSecond\" \\\n  --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ') \\\n  --end-time $(date -u '+%Y-%m-%dT%H:%M:%SZ') 2>/dev/null || echo \"Metrics not yet available\"\n\n# Operation 9: Check ARP table\necho \"To check ARP table on-premises:\"\necho \"show ip arp interface <interface> on service provider edge router\"\n\n# Operation 10: Review ExpressRoute activity logs\naz monitor activity-log list \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --query \"[?contains(resourceType, 'expressRouteCircuits')].{Time:eventTimestamp, Event:operationName.localizedValue, Status:status.localizedValue}\" \\\n  --output table\n```\n\n---\n\n## Phase 3: Cleanup and Tear-Down\n\n### Cleanup Steps\n```bash\n# Step 1: Delete VPN connection\naz network vpn-connection delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"ExpressRoute-Connection\" \\\n  --yes\n\n# Step 2: Delete gateway\naz network vnet-gateway delete \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --name \"${EXPRESSROUTE_GATEWAY}\" \\\n  --yes\n\n# Step 3: Delete peering\naz network express-route peering delete \\\n  --circuit-name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --name \"AzurePrivatePeering\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --yes 2>/dev/null || true\n\n# Step 4: Delete ExpressRoute circuit\naz network express-route delete \\\n  --name \"${EXPRESSROUTE_CIRCUIT}\" \\\n  --resource-group \"${RESOURCE_GROUP}\" \\\n  --yes\n\n# Step 5: Delete the entire resource group\naz group delete \\\n  --name \"${RESOURCE_GROUP}\" \\\n  --yes \\\n  --no-wait\n\n# Step 6: Verify deletion\nsleep 120\naz group exists --name \"${RESOURCE_GROUP}\"\n\n# Step 7: Confirm cleanup\necho \"Verifying cleanup...\"\naz resource list --resource-group \"${RESOURCE_GROUP}\" 2>&1 | grep \"could not be found\" && echo \"\u2713 Resource group successfully deleted\"\n\n# Step 8: Clean up local files\nrm -rf /tmp/peering_config.json /tmp/route_server_config.json /tmp/qos_config.json\n```\n\n---\n\n## Resource Naming Convention\n- Resource Group: `azurehaymaker-hybrid-expressroute-${UNIQUE_ID}-rg`\n- ExpressRoute Circuit: `azurehaymaker-er-${UNIQUE_ID}`\n- Gateway: `azurehaymaker-ergw-${UNIQUE_ID}`\n- Virtual Network: `azurehaymaker-vnet-${UNIQUE_ID}`\n- Key Vault: `azurehaymaker-kv-${UNIQUE_ID}`\n\nAll resources tagged with: `AzureHayMaker-managed=true`\n\n---\n\n## Documentation References\n- [ExpressRoute Overview](https://learn.microsoft.com/en-us/azure/expressroute/expressroute-introduction)\n- [ExpressRoute Connectivity Models](https://learn.microsoft.com/en-us/azure/expressroute/expressroute-connectivity-models)\n- [ExpressRoute Routing](https://learn.microsoft.com/en-us/azure/expressroute/expressroute-routing)\n- [ExpressRoute QoS](https://learn.microsoft.com/en-us/azure/expressroute/expressroute-qos)\n- [ExpressRoute CLI Reference](https://learn.microsoft.com/en-us/cli/azure/network/express-route)\n\n---\n\n## Automation Tool\n**Recommended**: Azure CLI + Terraform\n\n**Rationale**: Azure CLI handles ExpressRoute operations while Terraform manages infrastructure-as-code for reproducible deployments.\n\n---\n\n## Estimated Duration\n- **Deployment**: 20-30 minutes (circuit provisioning takes time)\n- **Operations Phase**: 8 hours (with monitoring and optimization)\n- **Cleanup**: 10-15 minutes\n\n---\n\n## Notes\n- ExpressRoute provides dedicated 1, 10, 40, or 100 Gbps bandwidth\n- Private peering for direct Azure resource access\n- Microsoft peering for Office 365 and Azure services\n- Public peering (deprecated) for backward compatibility\n- SLA provides 99.95% uptime for standard circuits\n- All operations scoped to single tenant and subscription\n- Redundancy recommended with multiple ExpressRoute circuits\n\n\n## Execution Plan\n\n### Phase 1: Test Planning\nPlan test strategy\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-design, planning\n\n### Phase 2: Test Implementation\nImplement test cases\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-coding, framework-setup\n**Dependencies**: Test Planning\n\n### Phase 3: Test Execution\nRun test suite\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: test-execution, automation\n**Dependencies**: Test Implementation\n\n### Phase 4: Results Analysis\nAnalyze test results\n**Estimated Duration**: 30 minutes\n**Required Capabilities**: analysis, reporting\n**Dependencies**: Test Execution\n\n## Success Criteria\n- Goal 'Scenario: ExpressRoute Private Connectivity...' is achieved\n\n## Instructions\nExecute the plan above autonomously:\n1. Follow each phase in sequence\n2. Use available skills and tools\n3. Verify success criteria are met\n4. Report progress and completion",
    "working_dir": ".",
    "sdk": "claude",
    "ui_mode": false,
    "success_criteria": [
      "Goal 'Scenario: ExpressRoute Private Connectivity...' is achieved"
    ],
    "constraints": []
  }
}
